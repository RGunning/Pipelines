--- 
0: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K4me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K4me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K4me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K4me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K4me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K4me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_B_20M BM_B_20M;\n\tdir=$(pwd);\n\tcomp=(BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\tcell=(B B);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bammergeonce: 
    cmd: cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; 		cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bammerge/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bammerge/var > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var || true; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/err
    condition: once
    placeholders: 
      - bammergeonce
      - jobs.bammerge.var
      - bammergeonce.var
      - bammergeonce.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#1.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#1.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#1.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#1.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#1.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#1.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#1.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#5.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#5.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtie_build: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -f /lustre/scratch109/sanger/rg12/genome/C57BL6J/mm10_C57BL6.fa.gz;\n\tbowtie2-build -f /lustre/scratch109/sanger/rg12/genome/C57BL6J/mm10_C57BL6.fa \\\n\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J;\n\tgzip /lustre/scratch109/sanger/rg12/genome/C57BL6J/mm10_C57BL6.fa;\n\ttouch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/err"
    condition: once
    mem: 5000
    placeholders: 
      - bowtie_build
      - bowtie_build.touch
      - bowtie_build.err
  bowtie_buildcast: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -f /lustre/scratch109/sanger/rg12/genome/CASTEiJ/mm10_CAST.fa.gz;\n\tbowtie2-build -f /lustre/scratch109/sanger/rg12/genome/CASTEiJ/mm10_CAST.fa \\\n\t\t/lustre/scratch109/sanger/rg12/genome/CASTEiJ_indexed/CASTEiJ;\n\tgzip /lustre/scratch109/sanger/rg12/genome/CASTEiJ/mm10_CAST.fa;\n\ttouch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/err"
    condition: once
    mem: 5000
    placeholders: 
      - bowtie_buildcast
      - bowtie_buildcast.touch
      - bowtie_buildcast.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  calldiff: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/calldiff;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\t# Only works with max 2 conditions\n\t# Set Var\n\t>&2 echo \"source /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var\";\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var;\n\tcomp=(BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\ttreat=($(eval echo \"\\$$(echo {treat${thisComp}B})\") $(eval echo \"\\$$(echo {treat${thisComp}T})\"));\n\tcont=($(eval echo \"\\$$(echo {cont${thisComp}B})\") $(eval echo \"\\$$(echo {cont${thisComp}T})\"));\n\txls=($(eval echo \"\\$$(echo {xls${thisComp}B})\") $(eval echo \"\\$$(echo {xls${thisComp}T})\"));\n\t#\n\t>&2 echo \"Get depth 1\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d1=${num1};else d1=${num2};fi;\n\t>&2 echo \"Got Depth: $d1 from $num1 and $num2\";\n\t>&2 echo \"Get depth 2\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d2=${num1};else d2=${num2};fi;\n\t>&2 echo \"Got Depth: $d2 from $num1 and $num2\";\n\t>&2 echo \"Run Calldiff\";\n\tmacs2 bdgdiff --t1 ${treat[0]} --c1 ${cont[0]} --t2 ${treat[1]} --c2 ${cont[1]} \\\n\t--d1 ${d1} --d2 ${d2} -g 100 -l 200 \\\n\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/calldiff/uniq1.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/calldiff/uniq2.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/calldiff/common.bed;\n\t# min length of differential region : 200\n\t# Maximum gap to merge nearby differential regions. Consider a wider gap for broad marks.\n\t# Maximum gap should be smaller than minimum length (-g). DEFAULT: 100 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/calldiff/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 20000
    placeholders: 
      - calldiff
      - macscollate.var
      - macscollate.var
      - groupby.replicate.datasource.comp
      - calldiff.uniq1.bed
      - calldiff.uniq2.bed
      - calldiff.common.bed
      - calldiff.err
  chipQC: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQC;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_B_4M_C BM_B_9M_C BM_B_20M_C BM_B_36M_C BM_T_4M_C BM_T_9M_C BM_T_20M_C BM_T_36M_C CM_B_27M_165 BM_B_4M_R BM_B_9M_R BM_B_20M_R BM_B_36M_R BM_T_4M_R BM_T_9M_R BM_T_20M_R BM_T_36M_R);\n\tTissue=(B B B B T T T T B B B B B T T T T);\n\tFactor=(4M 9M 20M 36M 4M 9M 20M 36M 27M 4M 9M 20M 36M 4M 9M 20M 36M);\n\tReplicate=(2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam);\n\tControlID=($(echo ${SampleID[@]} | sed -r 's/([a-zA-Z0-9_]+)/&_Inp/g'));\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQC/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[i]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQC/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQC/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=F, bCount=F, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQC/err"
    condition: once
    cores: 8
    mem: 20000
    placeholders: 
      - chipQC
      - jobs.datasource.Name
      - jobs.datasource.Cell
      - jobs.datasource.Mark
      - jobs.datasource.repeat
      - jobs.samtoolsview.duplicate.bam
      - jobs.samtoolsviewInp.duplicate.bam
      - jobs.macsunmergedbroadpeak.output2
      - chipQC.sample.csv
      - chipQC.sample.csv
      - chipQC.sample.csv
      - input.mm10-blacklist.bed
      - chipQC.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_B_20M_C BM_B_20M_R);\n\tTissue=(B B);\n\tFactor=(20M 20M);\n\tReplicate=(2 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam);\n\tControlID=(BM_B_Inp_2 BM_B_Inp_1);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  createhubgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/createhubgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t. /nfs/users/nfs_r/rg12/.bashrc;\n \t#ls * | grep -v err | xargs rm -rf; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/createhubgroup/err"
    condition: groupby
    condition_params: 
      - Mark
    mem: 5000
    placeholders: 
      - createhubgroup
      - createhubgroup.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/out1.png \\\n\t\t-t BM_B_4M_C_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/Inpout1.png \\\n\t\t-t BM_B_4M_C_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/out2.png \\\n\t\t\t-t BM_B_4M_C_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/Inpout2.png \\\n\t\t\t-t BM_B_4M_C_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  fragmentMark: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fragmentMark;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tMark=(20M 20M 20M 20M);\n\tthisMark=${Mark[0]};\n\teval \"h${thisMark}=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam)\";\n\tfiles=$(eval echo \"\\$$(echo {h$thisMark[@]})\");\n\t>&2 echo $files;\n\teval PD${thisMark}=$(macs2 predictd -i ${files} -f BAM -g mm |& \\\n\t\ttee -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fragmentMark/err| \\\n\t\tgrep \"predicted fragment length is .*\" -o | grep \"[0-9]*\" -o );\n\tdeclare -p $( echo PD${thisMark}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fragmentMark/out; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fragmentMark/err"
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - fragmentMark
      - groupby.Mark.datasource.Mark
      - groupby.Mark.samtoolsview.duplicate.bam
      - fragmentMark.err
      - fragmentMark.out
      - fragmentMark.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macscollate: 
    cmd: cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; 	cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsmergedbroad/var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsmergedbroad/var > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var || true; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/err
    condition: once
    placeholders: 
      - macscollate
      - jobs.macsmergedbroad.var
      - macscollate.var
      - macscollate.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_B_20M BM_B_20M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 250);\n\tpaired=(PE PE);\n\tMark=(20M 20M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\tcell=(B B);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD4M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  ngsavg: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavg;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_20M BM_20M BM_20M BM_20M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(20M 20M 20M 20M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_20M BM_20M BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavg/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavg/config.txt;\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavg/config.txt -O out -L 3000 -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavg/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavg
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.err
  ngsavgoverpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgoverpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_20M BM_20M BM_20M BM_20M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(20M 20M 20M 20M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_20M BM_20M BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\tpeak=($(eval echo \"\\$$(echo {peak${thisComp}B})\") $(eval echo \"\\$$(echo {peak${thisComp}T})\"));\n\tsed 's/chr//g' ${peak[0]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgoverpromoter/0.bed;\n\tsed 's/chr//g' ${peak[1]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgoverpromoter/1.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgoverpromoter/0.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgoverpromoter/genes.0.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgoverpromoter/1.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgoverpromoter/genes.1.bed; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgoverpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    placeholders: 
      - ngsavgoverpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.1.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.genes.0.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.1.bed
      - ngsavgoverpromoter.genes.1.bed
      - ngsavgoverpromoter.err
  ngsavgpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_20M BM_20M BM_20M BM_20M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(20M 20M 20M 20M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_20M BM_20M BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgpromoter/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgpromoter/config.txt;\n\tngs.plot.r -G mm10 -R tss -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgpromoter/config.txt -L 2000 -O out -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/ngsavgpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavgpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.err
  pdfmerge: 
    cmd: cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/pdfmerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; 	ls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/seperateclusters/config.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/pdfmerge/err
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - pdfmerge
      - groupby.Mark.seperateclusters.config.txt
      - pdfmerge.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  predictfragment: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#need to ignore err\n\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fragmentMark/out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fragmentMark/out > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out || true; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/err"
    condition: once
    placeholders: 
      - predictfragment
      - jobs.fragmentMark.out
      - predictfragment.out
      - predictfragment.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K4me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_B_4M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#1.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\techo \"BM_B_4M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#1.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\techo \"Input BM_B_4M_C_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\techo \"Input BM_B_4M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_B_4M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#1.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\techo \"BM_B_4M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#1.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\telse echo \"BM_B_4M_C\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  symlink: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/symlink;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\trunnum=$(echo \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var\" |sed -r 's/.*run([0-9]+).*/\\1/');\n\tplite symlink -f replicate -n Bammerge -r $runnum -s bammergeonce#var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f replicate -n fragmentlength -r $runnum -s predictfragment#out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f replicate -n macspeaks -r $runnum -s macscollate#var /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/symlink/err"
    condition: once
    placeholders: 
      - symlink
      - bammergeonce.var
      - symlink.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ATCACGTT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ATCACGTT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ACAGTGGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ACAGTGGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
  wigcorrelateall: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/wigcorrelateall;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\t## ONLY SAYS HOW THE ALIGNMENT CORRELATES\n\t>&2 echo \"wigCorrelate macsunmergedbroadpeak FoldE\";\n\twigCorrelate /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/FoldE.bw > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/wigcorrelateall/macsunmergedbroadpeak_FoldE.txt;\n\t>&2 echo \"wigCorrelate macsunmergedbroadpeak LogLR\";\n\twigCorrelate /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/logLR.bw > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/wigcorrelateall/macsunmergedbroadpeak_logLR.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/wigcorrelateall/err"
    condition: once
    cores: 4
    mem: 5000
    placeholders: 
      - wigcorrelateall
      - jobs.macsunmergedbroadpeak.output6
      - wigcorrelateall.macsunmergedbroadpeak_FoldE.txt
      - jobs.macsunmergedbroadpeak.output7
      - wigcorrelateall.macsunmergedbroadpeak_logLR.txt
      - wigcorrelateall.err
1: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K9me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K9me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K9me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K9me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K9me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K9me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_B_36M BM_B_36M;\n\tdir=$(pwd);\n\tcomp=(BM_36M BM_36M);\n\tthisComp=${comp[0]};\n\tcell=(B B);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#2.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#2.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#2.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#2.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#2.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#2.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#2.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#5.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#5.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  calldiff: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/calldiff;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\t# Only works with max 2 conditions\n\t# Set Var\n\t>&2 echo \"source /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var\";\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var;\n\tcomp=(BM_36M BM_36M);\n\tthisComp=${comp[0]};\n\ttreat=($(eval echo \"\\$$(echo {treat${thisComp}B})\") $(eval echo \"\\$$(echo {treat${thisComp}T})\"));\n\tcont=($(eval echo \"\\$$(echo {cont${thisComp}B})\") $(eval echo \"\\$$(echo {cont${thisComp}T})\"));\n\txls=($(eval echo \"\\$$(echo {xls${thisComp}B})\") $(eval echo \"\\$$(echo {xls${thisComp}T})\"));\n\t#\n\t>&2 echo \"Get depth 1\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d1=${num1};else d1=${num2};fi;\n\t>&2 echo \"Got Depth: $d1 from $num1 and $num2\";\n\t>&2 echo \"Get depth 2\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d2=${num1};else d2=${num2};fi;\n\t>&2 echo \"Got Depth: $d2 from $num1 and $num2\";\n\t>&2 echo \"Run Calldiff\";\n\tmacs2 bdgdiff --t1 ${treat[0]} --c1 ${cont[0]} --t2 ${treat[1]} --c2 ${cont[1]} \\\n\t--d1 ${d1} --d2 ${d2} -g 100 -l 200 \\\n\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/calldiff/uniq1.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/calldiff/uniq2.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/calldiff/common.bed;\n\t# min length of differential region : 200\n\t# Maximum gap to merge nearby differential regions. Consider a wider gap for broad marks.\n\t# Maximum gap should be smaller than minimum length (-g). DEFAULT: 100 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/calldiff/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 20000
    placeholders: 
      - calldiff
      - macscollate.var
      - macscollate.var
      - groupby.replicate.datasource.comp
      - calldiff.uniq1.bed
      - calldiff.uniq2.bed
      - calldiff.common.bed
      - calldiff.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_B_36M_C BM_B_36M_R);\n\tTissue=(B B);\n\tFactor=(36M 36M);\n\tReplicate=(2 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam);\n\tControlID=(BM_B_Inp_2 BM_B_Inp_1);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  createhubgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/createhubgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t. /nfs/users/nfs_r/rg12/.bashrc;\n \t#ls * | grep -v err | xargs rm -rf; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/createhubgroup/err"
    condition: groupby
    condition_params: 
      - Mark
    mem: 5000
    placeholders: 
      - createhubgroup
      - createhubgroup.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/out1.png \\\n\t\t-t BM_B_9M_C_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/Inpout1.png \\\n\t\t-t BM_B_9M_C_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/out2.png \\\n\t\t\t-t BM_B_9M_C_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/Inpout2.png \\\n\t\t\t-t BM_B_9M_C_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  fragmentMark: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fragmentMark;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tMark=(27M);\n\tthisMark=${Mark[0]};\n\teval \"h${thisMark}=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam)\";\n\tfiles=$(eval echo \"\\$$(echo {h$thisMark[@]})\");\n\t>&2 echo $files;\n\teval PD${thisMark}=$(macs2 predictd -i ${files} -f BAM -g mm |& \\\n\t\ttee -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fragmentMark/err| \\\n\t\tgrep \"predicted fragment length is .*\" -o | grep \"[0-9]*\" -o );\n\tdeclare -p $( echo PD${thisMark}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fragmentMark/out; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/fragmentMark/err"
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - fragmentMark
      - groupby.Mark.datasource.Mark
      - groupby.Mark.samtoolsview.duplicate.bam
      - fragmentMark.err
      - fragmentMark.out
      - fragmentMark.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_B_36M BM_B_36M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 250);\n\tpaired=(PE PE);\n\tMark=(36M 36M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(BM_36M BM_36M);\n\tthisComp=${comp[0]};\n\tcell=(B B);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD9M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  ngsavg: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavg;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_36M BM_36M BM_36M BM_36M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(36M 36M 36M 36M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_36M BM_36M BM_36M BM_36M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavg/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavg/config.txt;\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavg/config.txt -O out -L 3000 -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavg/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavg
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.err
  ngsavgoverpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgoverpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_36M BM_36M BM_36M BM_36M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(36M 36M 36M 36M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_36M BM_36M BM_36M BM_36M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\tpeak=($(eval echo \"\\$$(echo {peak${thisComp}B})\") $(eval echo \"\\$$(echo {peak${thisComp}T})\"));\n\tsed 's/chr//g' ${peak[0]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgoverpromoter/0.bed;\n\tsed 's/chr//g' ${peak[1]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgoverpromoter/1.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgoverpromoter/0.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgoverpromoter/genes.0.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgoverpromoter/1.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgoverpromoter/genes.1.bed; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgoverpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    placeholders: 
      - ngsavgoverpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.1.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.genes.0.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.1.bed
      - ngsavgoverpromoter.genes.1.bed
      - ngsavgoverpromoter.err
  ngsavgpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_36M BM_36M BM_36M BM_36M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(36M 36M 36M 36M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_36M BM_36M BM_36M BM_36M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgpromoter/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgpromoter/config.txt;\n\tngs.plot.r -G mm10 -R tss -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgpromoter/config.txt -L 2000 -O out -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/ngsavgpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavgpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.err
  pdfmerge: 
    cmd: cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/pdfmerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; 	ls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/seperateclusters/config.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/pdfmerge/err
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - pdfmerge
      - groupby.Mark.seperateclusters.config.txt
      - pdfmerge.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K9me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_B_9M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#2.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\techo \"BM_B_9M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#2.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\techo \"Input BM_B_9M_C_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\techo \"Input BM_B_9M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_B_9M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#2.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\techo \"BM_B_9M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#2.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\telse echo \"BM_B_9M_C\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a CGATGTTT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a CGATGTTT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ACAGTGGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ACAGTGGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
10: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K9me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K9me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K9me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K9me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K9me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K9me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#2.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#2.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#2.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#2.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#2.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#2.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#2.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#9.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#9.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/out1.png \\\n\t\t-t BM_B_9M_R_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/Inpout1.png \\\n\t\t-t BM_B_9M_R_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/out2.png \\\n\t\t\t-t BM_B_9M_R_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/Inpout2.png \\\n\t\t\t-t BM_B_9M_R_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD9M};\n\tif [ -z \"$PD\" ];then PD=250; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K9me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_B_9M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#2.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\techo \"BM_B_9M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#2.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\techo \"Input BM_B_9M_R_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\techo \"Input BM_B_9M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_B_9M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_1#2.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\techo \"BM_B_9M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_2#2.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\telse echo \"BM_B_9M_R\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a CGATGTTT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a CGATGTTT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a GATCAGCG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a GATCAGCG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
11: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H4K20me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H4K20me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H4K20me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H4K20me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H4K20me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H4K20me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#3.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#3.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#3.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#3.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#3.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#3.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#3.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#9.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#9.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/out1.png \\\n\t\t-t BM_B_20M_R_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/Inpout1.png \\\n\t\t-t BM_B_20M_R_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/out2.png \\\n\t\t\t-t BM_B_20M_R_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/Inpout2.png \\\n\t\t\t-t BM_B_20M_R_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD20M};\n\tif [ -z \"$PD\" ];then PD=250; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H4K20me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_B_20M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#3.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\techo \"BM_B_20M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#3.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\techo \"Input BM_B_20M_R_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\techo \"Input BM_B_20M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_B_20M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_1#3.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\techo \"BM_B_20M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_2#3.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\telse echo \"BM_B_20M_R\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TTAGGCAT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TTAGGCAT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a GATCAGCG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a GATCAGCG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job11/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
12: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K36me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K36me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K36me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K36me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K36me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K36me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#4.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#4.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#4.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#4.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#4.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#4.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#4.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#9.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#9.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/out1.png \\\n\t\t-t BM_B_36M_R_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/Inpout1.png \\\n\t\t-t BM_B_36M_R_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/out2.png \\\n\t\t\t-t BM_B_36M_R_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/Inpout2.png \\\n\t\t\t-t BM_B_36M_R_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD36M};\n\tif [ -z \"$PD\" ];then PD=250; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K36me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_B_36M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#4.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\techo \"BM_B_36M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#4.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\techo \"Input BM_B_36M_R_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\techo \"Input BM_B_36M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_B_36M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_1#4.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\techo \"BM_B_36M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_2#4.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\telse echo \"BM_B_36M_R\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TGACCACT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TGACCACT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a GATCAGCG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a GATCAGCG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
13: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K4me3 T Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K4me3 T Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K4me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K4me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K4me3 T Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K4me3 T Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#5.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#5.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#5.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#5.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#5.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#10.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#10.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/out1.png \\\n\t\t-t BM_T_4M_R_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/Inpout1.png \\\n\t\t-t BM_T_4M_R_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/out2.png \\\n\t\t\t-t BM_T_4M_R_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/Inpout2.png \\\n\t\t\t-t BM_T_4M_R_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD4M};\n\tif [ -z \"$PD\" ];then PD=250; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K4me3 T Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_T_4M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\techo \"BM_T_4M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\techo \"Input BM_T_4M_R_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\techo \"Input BM_T_4M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_T_4M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_1#5.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\techo \"BM_T_4M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_2#5.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\telse echo \"BM_T_4M_R\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ACAGTGGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ACAGTGGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TAGCTTGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TAGCTTGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
14: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K9me3 T Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K9me3 T Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K9me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K9me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K9me3 T Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K9me3 T Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#6.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#6.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#6.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#6.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#6.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#6.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#6.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#10.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#10.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/out1.png \\\n\t\t-t BM_T_9M_R_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/Inpout1.png \\\n\t\t-t BM_T_9M_R_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/out2.png \\\n\t\t\t-t BM_T_9M_R_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/Inpout2.png \\\n\t\t\t-t BM_T_9M_R_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD9M};\n\tif [ -z \"$PD\" ];then PD=250; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K9me3 T Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_T_9M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#6.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\techo \"BM_T_9M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#6.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\techo \"Input BM_T_9M_R_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\techo \"Input BM_T_9M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_T_9M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_1#6.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\techo \"BM_T_9M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_2#6.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\telse echo \"BM_T_9M_R\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a GCCAATGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a GCCAATGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TAGCTTGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TAGCTTGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
15: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H4K20me3 T Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H4K20me3 T Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H4K20me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H4K20me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H4K20me3 T Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H4K20me3 T Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#7.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#7.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#7.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#7.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#7.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#7.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#7.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#10.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#10.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/out1.png \\\n\t\t-t BM_T_20M_R_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/Inpout1.png \\\n\t\t-t BM_T_20M_R_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/out2.png \\\n\t\t\t-t BM_T_20M_R_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/Inpout2.png \\\n\t\t\t-t BM_T_20M_R_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD20M};\n\tif [ -z \"$PD\" ];then PD=250; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H4K20me3 T Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_T_20M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#7.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\techo \"BM_T_20M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#7.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\techo \"Input BM_T_20M_R_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\techo \"Input BM_T_20M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_T_20M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_1#7.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\techo \"BM_T_20M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_2#7.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\telse echo \"BM_T_20M_R\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a CAGATCTG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a CAGATCTG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TAGCTTGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TAGCTTGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
16: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K36me3 T Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K36me3 T Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K36me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K36me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K36me3 T Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K36me3 T Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#8.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#8.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#8.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#8.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#8.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#8.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#8.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#10.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#10.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/out1.png \\\n\t\t-t BM_T_36M_R_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/Inpout1.png \\\n\t\t-t BM_T_36M_R_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/out2.png \\\n\t\t\t-t BM_T_36M_R_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/Inpout2.png \\\n\t\t\t-t BM_T_36M_R_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD36M};\n\tif [ -z \"$PD\" ];then PD=250; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K36me3 T Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_T_36M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#8.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\techo \"BM_T_36M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#8.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\techo \"Input BM_T_36M_R_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\techo \"Input BM_T_36M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_T_36M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_1#8.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\techo \"BM_T_36M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_2#8.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\telse echo \"BM_T_36M_R\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ACTTGATG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ACTTGATG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TAGCTTGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TAGCTTGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
2: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H4K20me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H4K20me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H4K20me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H4K20me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H4K20me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H4K20me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_B_4M BM_B_4M;\n\tdir=$(pwd);\n\tcomp=(BM_4M BM_4M);\n\tthisComp=${comp[0]};\n\tcell=(B B);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#3.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#3.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#3.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#3.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#3.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#3.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#3.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#5.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#5.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  calldiff: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/calldiff;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\t# Only works with max 2 conditions\n\t# Set Var\n\t>&2 echo \"source /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var\";\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var;\n\tcomp=(BM_4M BM_4M);\n\tthisComp=${comp[0]};\n\ttreat=($(eval echo \"\\$$(echo {treat${thisComp}B})\") $(eval echo \"\\$$(echo {treat${thisComp}T})\"));\n\tcont=($(eval echo \"\\$$(echo {cont${thisComp}B})\") $(eval echo \"\\$$(echo {cont${thisComp}T})\"));\n\txls=($(eval echo \"\\$$(echo {xls${thisComp}B})\") $(eval echo \"\\$$(echo {xls${thisComp}T})\"));\n\t#\n\t>&2 echo \"Get depth 1\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d1=${num1};else d1=${num2};fi;\n\t>&2 echo \"Got Depth: $d1 from $num1 and $num2\";\n\t>&2 echo \"Get depth 2\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d2=${num1};else d2=${num2};fi;\n\t>&2 echo \"Got Depth: $d2 from $num1 and $num2\";\n\t>&2 echo \"Run Calldiff\";\n\tmacs2 bdgdiff --t1 ${treat[0]} --c1 ${cont[0]} --t2 ${treat[1]} --c2 ${cont[1]} \\\n\t--d1 ${d1} --d2 ${d2} -g 100 -l 200 \\\n\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/calldiff/uniq1.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/calldiff/uniq2.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/calldiff/common.bed;\n\t# min length of differential region : 200\n\t# Maximum gap to merge nearby differential regions. Consider a wider gap for broad marks.\n\t# Maximum gap should be smaller than minimum length (-g). DEFAULT: 100 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/calldiff/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 20000
    placeholders: 
      - calldiff
      - macscollate.var
      - macscollate.var
      - groupby.replicate.datasource.comp
      - calldiff.uniq1.bed
      - calldiff.uniq2.bed
      - calldiff.common.bed
      - calldiff.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_B_4M_C BM_B_4M_R);\n\tTissue=(B B);\n\tFactor=(4M 4M);\n\tReplicate=(2 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam);\n\tControlID=(BM_B_Inp_2 BM_B_Inp_1);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  createhubgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/createhubgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t. /nfs/users/nfs_r/rg12/.bashrc;\n \t#ls * | grep -v err | xargs rm -rf; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/createhubgroup/err"
    condition: groupby
    condition_params: 
      - Mark
    mem: 5000
    placeholders: 
      - createhubgroup
      - createhubgroup.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/out1.png \\\n\t\t-t BM_B_20M_C_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/Inpout1.png \\\n\t\t-t BM_B_20M_C_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/out2.png \\\n\t\t\t-t BM_B_20M_C_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/Inpout2.png \\\n\t\t\t-t BM_B_20M_C_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  fragmentMark: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fragmentMark;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tMark=(36M 36M 36M 36M);\n\tthisMark=${Mark[0]};\n\teval \"h${thisMark}=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam)\";\n\tfiles=$(eval echo \"\\$$(echo {h$thisMark[@]})\");\n\t>&2 echo $files;\n\teval PD${thisMark}=$(macs2 predictd -i ${files} -f BAM -g mm |& \\\n\t\ttee -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fragmentMark/err| \\\n\t\tgrep \"predicted fragment length is .*\" -o | grep \"[0-9]*\" -o );\n\tdeclare -p $( echo PD${thisMark}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fragmentMark/out; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/fragmentMark/err"
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - fragmentMark
      - groupby.Mark.datasource.Mark
      - groupby.Mark.samtoolsview.duplicate.bam
      - fragmentMark.err
      - fragmentMark.out
      - fragmentMark.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_B_4M BM_B_4M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 250);\n\tpaired=(PE PE);\n\tMark=(4M 4M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(BM_4M BM_4M);\n\tthisComp=${comp[0]};\n\tcell=(B B);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD20M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  ngsavg: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavg;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_4M BM_4M BM_4M BM_4M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(4M 4M 4M 4M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_4M BM_4M BM_4M BM_4M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavg/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavg/config.txt;\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavg/config.txt -O out -L 3000 -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavg/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavg
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.err
  ngsavgoverpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgoverpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_4M BM_4M BM_4M BM_4M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(4M 4M 4M 4M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_4M BM_4M BM_4M BM_4M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\tpeak=($(eval echo \"\\$$(echo {peak${thisComp}B})\") $(eval echo \"\\$$(echo {peak${thisComp}T})\"));\n\tsed 's/chr//g' ${peak[0]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgoverpromoter/0.bed;\n\tsed 's/chr//g' ${peak[1]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgoverpromoter/1.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgoverpromoter/0.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgoverpromoter/genes.0.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgoverpromoter/1.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgoverpromoter/genes.1.bed; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgoverpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    placeholders: 
      - ngsavgoverpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.1.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.genes.0.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.1.bed
      - ngsavgoverpromoter.genes.1.bed
      - ngsavgoverpromoter.err
  ngsavgpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_4M BM_4M BM_4M BM_4M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(4M 4M 4M 4M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_4M BM_4M BM_4M BM_4M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgpromoter/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgpromoter/config.txt;\n\tngs.plot.r -G mm10 -R tss -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgpromoter/config.txt -L 2000 -O out -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/ngsavgpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavgpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.err
  pdfmerge: 
    cmd: cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/pdfmerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; 	ls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job12/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/seperateclusters/config.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/pdfmerge/err
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - pdfmerge
      - groupby.Mark.seperateclusters.config.txt
      - pdfmerge.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H4K20me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_B_20M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#3.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\techo \"BM_B_20M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#3.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\techo \"Input BM_B_20M_C_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\techo \"Input BM_B_20M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_B_20M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#3.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\techo \"BM_B_20M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#3.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\telse echo \"BM_B_20M_C\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TTAGGCAT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TTAGGCAT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ACAGTGGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ACAGTGGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job2/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
3: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K36me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K36me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K36me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K36me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K36me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K36me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_B_9M BM_B_9M;\n\tdir=$(pwd);\n\tcomp=(BM_9M BM_9M);\n\tthisComp=${comp[0]};\n\tcell=(B B);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#4.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#4.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#4.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#4.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#4.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#4.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#4.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#5.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#5.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#5.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#5.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  calldiff: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/calldiff;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\t# Only works with max 2 conditions\n\t# Set Var\n\t>&2 echo \"source /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var\";\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var;\n\tcomp=(BM_9M BM_9M);\n\tthisComp=${comp[0]};\n\ttreat=($(eval echo \"\\$$(echo {treat${thisComp}B})\") $(eval echo \"\\$$(echo {treat${thisComp}T})\"));\n\tcont=($(eval echo \"\\$$(echo {cont${thisComp}B})\") $(eval echo \"\\$$(echo {cont${thisComp}T})\"));\n\txls=($(eval echo \"\\$$(echo {xls${thisComp}B})\") $(eval echo \"\\$$(echo {xls${thisComp}T})\"));\n\t#\n\t>&2 echo \"Get depth 1\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d1=${num1};else d1=${num2};fi;\n\t>&2 echo \"Got Depth: $d1 from $num1 and $num2\";\n\t>&2 echo \"Get depth 2\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d2=${num1};else d2=${num2};fi;\n\t>&2 echo \"Got Depth: $d2 from $num1 and $num2\";\n\t>&2 echo \"Run Calldiff\";\n\tmacs2 bdgdiff --t1 ${treat[0]} --c1 ${cont[0]} --t2 ${treat[1]} --c2 ${cont[1]} \\\n\t--d1 ${d1} --d2 ${d2} -g 100 -l 200 \\\n\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/calldiff/uniq1.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/calldiff/uniq2.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/calldiff/common.bed;\n\t# min length of differential region : 200\n\t# Maximum gap to merge nearby differential regions. Consider a wider gap for broad marks.\n\t# Maximum gap should be smaller than minimum length (-g). DEFAULT: 100 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/calldiff/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 20000
    placeholders: 
      - calldiff
      - macscollate.var
      - macscollate.var
      - groupby.replicate.datasource.comp
      - calldiff.uniq1.bed
      - calldiff.uniq2.bed
      - calldiff.common.bed
      - calldiff.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_B_9M_C BM_B_9M_R);\n\tTissue=(B B);\n\tFactor=(9M 9M);\n\tReplicate=(2 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam);\n\tControlID=(BM_B_Inp_2 BM_B_Inp_1);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  createhubgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/createhubgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t. /nfs/users/nfs_r/rg12/.bashrc;\n \t#ls * | grep -v err | xargs rm -rf; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/createhubgroup/err"
    condition: groupby
    condition_params: 
      - Mark
    mem: 5000
    placeholders: 
      - createhubgroup
      - createhubgroup.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/out1.png \\\n\t\t-t BM_B_36M_C_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/Inpout1.png \\\n\t\t-t BM_B_36M_C_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/out2.png \\\n\t\t\t-t BM_B_36M_C_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/Inpout2.png \\\n\t\t\t-t BM_B_36M_C_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  fragmentMark: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fragmentMark;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tMark=(4M 4M 4M 4M);\n\tthisMark=${Mark[0]};\n\teval \"h${thisMark}=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam)\";\n\tfiles=$(eval echo \"\\$$(echo {h$thisMark[@]})\");\n\t>&2 echo $files;\n\teval PD${thisMark}=$(macs2 predictd -i ${files} -f BAM -g mm |& \\\n\t\ttee -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fragmentMark/err| \\\n\t\tgrep \"predicted fragment length is .*\" -o | grep \"[0-9]*\" -o );\n\tdeclare -p $( echo PD${thisMark}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fragmentMark/out; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/fragmentMark/err"
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - fragmentMark
      - groupby.Mark.datasource.Mark
      - groupby.Mark.samtoolsview.duplicate.bam
      - fragmentMark.err
      - fragmentMark.out
      - fragmentMark.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_B_9M BM_B_9M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 250);\n\tpaired=(PE PE);\n\tMark=(9M 9M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(BM_9M BM_9M);\n\tthisComp=${comp[0]};\n\tcell=(B B);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD36M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  ngsavg: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavg;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_9M BM_9M BM_9M BM_9M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(9M 9M 9M 9M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_9M BM_9M BM_9M BM_9M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavg/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavg/config.txt;\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavg/config.txt -O out -L 3000 -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavg/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavg
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.err
  ngsavgoverpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgoverpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_9M BM_9M BM_9M BM_9M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(9M 9M 9M 9M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_9M BM_9M BM_9M BM_9M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\tpeak=($(eval echo \"\\$$(echo {peak${thisComp}B})\") $(eval echo \"\\$$(echo {peak${thisComp}T})\"));\n\tsed 's/chr//g' ${peak[0]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgoverpromoter/0.bed;\n\tsed 's/chr//g' ${peak[1]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgoverpromoter/1.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgoverpromoter/0.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgoverpromoter/genes.0.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgoverpromoter/1.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgoverpromoter/genes.1.bed; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgoverpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    placeholders: 
      - ngsavgoverpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.1.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.genes.0.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.1.bed
      - ngsavgoverpromoter.genes.1.bed
      - ngsavgoverpromoter.err
  ngsavgpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_9M BM_9M BM_9M BM_9M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 200 250 250);\n\tMark=(9M 9M 9M 9M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(BM_9M BM_9M BM_9M BM_9M);\n\tthisComp=${comp[0]};\n\tcell=(B T B T);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgpromoter/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgpromoter/config.txt;\n\tngs.plot.r -G mm10 -R tss -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgpromoter/config.txt -L 2000 -O out -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/ngsavgpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavgpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.err
  pdfmerge: 
    cmd: cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/pdfmerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; 	ls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/seperateclusters/config.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/pdfmerge/err
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - pdfmerge
      - groupby.Mark.seperateclusters.config.txt
      - pdfmerge.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K36me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_B_36M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#4.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\techo \"BM_B_36M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#4.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\techo \"Input BM_B_36M_C_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\techo \"Input BM_B_36M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#5.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_B_36M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#4.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\techo \"BM_B_36M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#4.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\telse echo \"BM_B_36M_C\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TGACCACT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TGACCACT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ACAGTGGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ACAGTGGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job3/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
4: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K4me3 T Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K4me3 T Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K4me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K4me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K4me3 T Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K4me3 T Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_T_20M BM_T_20M;\n\tdir=$(pwd);\n\tcomp=(BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\tcell=(T T);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#6.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#6.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#6.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#6.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#6.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#6.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#6.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#10.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#10.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  calldiff: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/calldiff;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\t# Only works with max 2 conditions\n\t# Set Var\n\t>&2 echo \"source /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var\";\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/macscollate/var;\n\tcomp=(BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\ttreat=($(eval echo \"\\$$(echo {treat${thisComp}B})\") $(eval echo \"\\$$(echo {treat${thisComp}T})\"));\n\tcont=($(eval echo \"\\$$(echo {cont${thisComp}B})\") $(eval echo \"\\$$(echo {cont${thisComp}T})\"));\n\txls=($(eval echo \"\\$$(echo {xls${thisComp}B})\") $(eval echo \"\\$$(echo {xls${thisComp}T})\"));\n\t#\n\t>&2 echo \"Get depth 1\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[0]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d1=${num1};else d1=${num2};fi;\n\t>&2 echo \"Got Depth: $d1 from $num1 and $num2\";\n\t>&2 echo \"Get depth 2\";\n\tnum1=$(grep \"after filtering in treatment: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tnum2=$(grep \"after filtering in control: .*\" -o ${xls[1]} | grep \"[0-9]*\" -o);\n\tif (( num1 < num2 ));then d2=${num1};else d2=${num2};fi;\n\t>&2 echo \"Got Depth: $d2 from $num1 and $num2\";\n\t>&2 echo \"Run Calldiff\";\n\tmacs2 bdgdiff --t1 ${treat[0]} --c1 ${cont[0]} --t2 ${treat[1]} --c2 ${cont[1]} \\\n\t--d1 ${d1} --d2 ${d2} -g 100 -l 200 \\\n\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/calldiff/uniq1.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/calldiff/uniq2.bed /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/calldiff/common.bed;\n\t# min length of differential region : 200\n\t# Maximum gap to merge nearby differential regions. Consider a wider gap for broad marks.\n\t# Maximum gap should be smaller than minimum length (-g). DEFAULT: 100 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/calldiff/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 20000
    placeholders: 
      - calldiff
      - macscollate.var
      - macscollate.var
      - groupby.replicate.datasource.comp
      - calldiff.uniq1.bed
      - calldiff.uniq2.bed
      - calldiff.common.bed
      - calldiff.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_T_20M_C BM_T_20M_R);\n\tTissue=(T T);\n\tFactor=(20M 20M);\n\tReplicate=(2 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam);\n\tControlID=(BM_T_Inp_2 BM_T_Inp_1);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  createhubgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/createhubgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t. /nfs/users/nfs_r/rg12/.bashrc;\n \t#ls * | grep -v err | xargs rm -rf; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/createhubgroup/err"
    condition: groupby
    condition_params: 
      - Mark
    mem: 5000
    placeholders: 
      - createhubgroup
      - createhubgroup.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/out1.png \\\n\t\t-t BM_T_4M_C_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/Inpout1.png \\\n\t\t-t BM_T_4M_C_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/out2.png \\\n\t\t\t-t BM_T_4M_C_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/Inpout2.png \\\n\t\t\t-t BM_T_4M_C_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  fragmentMark: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fragmentMark;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tMark=(9M 9M 9M 9M);\n\tthisMark=${Mark[0]};\n\teval \"h${thisMark}=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam)\";\n\tfiles=$(eval echo \"\\$$(echo {h$thisMark[@]})\");\n\t>&2 echo $files;\n\teval PD${thisMark}=$(macs2 predictd -i ${files} -f BAM -g mm |& \\\n\t\ttee -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fragmentMark/err| \\\n\t\tgrep \"predicted fragment length is .*\" -o | grep \"[0-9]*\" -o );\n\tdeclare -p $( echo PD${thisMark}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fragmentMark/out; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/fragmentMark/err"
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - fragmentMark
      - groupby.Mark.datasource.Mark
      - groupby.Mark.samtoolsview.duplicate.bam
      - fragmentMark.err
      - fragmentMark.out
      - fragmentMark.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_T_20M BM_T_20M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 250);\n\tpaired=(PE PE);\n\tMark=(20M 20M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(BM_20M BM_20M);\n\tthisComp=${comp[0]};\n\tcell=(T T);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD4M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  ngsavg: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavg;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch CM_27M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200);\n\tMark=(27M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(CM_27M);\n\tthisComp=${comp[0]};\n\tcell=(B);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavg/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavg/config.txt;\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavg/config.txt -O out -L 3000 -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavg/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavg
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.config.txt
      - ngsavg.err
  ngsavgoverpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgoverpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch CM_27M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200);\n\tMark=(27M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(CM_27M);\n\tthisComp=${comp[0]};\n\tcell=(B);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\tpeak=($(eval echo \"\\$$(echo {peak${thisComp}B})\") $(eval echo \"\\$$(echo {peak${thisComp}T})\"));\n\tsed 's/chr//g' ${peak[0]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgoverpromoter/0.bed;\n\tsed 's/chr//g' ${peak[1]} | bedtools sort > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgoverpromoter/1.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgoverpromoter/0.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgoverpromoter/genes.0.bed;\n\tbedtools intersect -u -f 0.1 -F 0.1 -e -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgoverpromoter/1.bed > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgoverpromoter/genes.1.bed; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgoverpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    placeholders: 
      - ngsavgoverpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.1.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.0.bed
      - ngsavgoverpromoter.genes.0.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - ngsavgoverpromoter.1.bed
      - ngsavgoverpromoter.genes.1.bed
      - ngsavgoverpromoter.err
  ngsavgpromoter: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgpromoter;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch CM_27M;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200);\n\tMark=(27M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bammergeonce/var;\n\tcomp=(CM_27M);\n\tthisComp=${comp[0]};\n\tcell=(B);\n\ttreat=($(eval echo \"\\$$(echo {sample${thisComp}B})\") $(eval echo \"\\$$(echo {sample${thisComp}T})\"));\n\tinput=($(eval echo \"\\$$(echo {input${thisComp}B})\") $(eval echo \"\\$$(echo {input${thisComp}T})\"));\n\t#treatment=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bammerge/merged.bam);\n\t#input=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job15/bammerge/merged.bam);\n\techo -e \"${treat[0]}:${input[0]}\t-1\t\\\"${cell[0]} Cell\\\"\t${PD}\tgreen\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgpromoter/config.txt;\n\techo -e \"${treat[1]}:${input[1]}\t-1\t\\\"${cell[1]} Cell\\\"\t${PD}\tblue\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgpromoter/config.txt;\n\tngs.plot.r -G mm10 -R tss -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgpromoter/config.txt -L 2000 -O out -CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/ngsavgpromoter/err"
    condition: groupby
    condition_params: 
      - comp
    cores: 5
    mem: 5000
    placeholders: 
      - ngsavgpromoter
      - groupby.comp.datasource.comp
      - predictfragment.out
      - groupby.comp.datasource.sonication
      - groupby.comp.datasource.Mark
      - bammergeonce.var
      - groupby.comp.datasource.comp
      - groupby.comp.datasource.Cell
      - groupby.replicate.bammerge.merged.bam
      - groupby.replicate.bammerge.merged.bam
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.config.txt
      - ngsavgpromoter.err
  pdfmerge: 
    cmd: cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/pdfmerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; 	ls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job1/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job10/seperateclusters/config.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/seperateclusters/config.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/pdfmerge/err
    condition: groupby
    condition_params: 
      - Mark
    cores: 5
    mem: 5000
    placeholders: 
      - pdfmerge
      - groupby.Mark.seperateclusters.config.txt
      - pdfmerge.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K4me3 T Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_T_4M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#6.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\techo \"BM_T_4M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#6.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\techo \"Input BM_T_4M_C_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\techo \"Input BM_T_4M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_T_4M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#6.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\techo \"BM_T_4M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#6.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\telse echo \"BM_T_4M_C\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a GCCAATGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a GCCAATGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TAGCTTGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TAGCTTGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
5: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K9me3 T Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K9me3 T Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K9me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K9me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K9me3 T Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K9me3 T Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_T_36M BM_T_36M;\n\tdir=$(pwd);\n\tcomp=(BM_36M BM_36M);\n\tthisComp=${comp[0]};\n\tcell=(T T);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#7.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#7.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#7.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#7.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#7.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#7.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#7.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#10.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#10.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_T_36M_C BM_T_36M_R);\n\tTissue=(T T);\n\tFactor=(36M 36M);\n\tReplicate=(2 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam);\n\tControlID=(BM_T_Inp_2 BM_T_Inp_1);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/out1.png \\\n\t\t-t BM_T_9M_C_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/Inpout1.png \\\n\t\t-t BM_T_9M_C_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/out2.png \\\n\t\t\t-t BM_T_9M_C_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/Inpout2.png \\\n\t\t\t-t BM_T_9M_C_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_T_36M BM_T_36M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 250);\n\tpaired=(PE PE);\n\tMark=(36M 36M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(BM_36M BM_36M);\n\tthisComp=${comp[0]};\n\tcell=(T T);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job16/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD9M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K9me3 T Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_T_9M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#7.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\techo \"BM_T_9M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#7.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\techo \"Input BM_T_9M_C_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\techo \"Input BM_T_9M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_T_9M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#7.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\techo \"BM_T_9M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#7.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\telse echo \"BM_T_9M_C\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a CAGATCTG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a CAGATCTG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TAGCTTGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TAGCTTGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
6: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H4K20me3 T Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H4K20me3 T Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H4K20me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H4K20me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H4K20me3 T Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H4K20me3 T Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_T_4M BM_T_4M;\n\tdir=$(pwd);\n\tcomp=(BM_4M BM_4M);\n\tthisComp=${comp[0]};\n\tcell=(T T);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#8.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#8.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#8.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#8.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#8.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#8.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#8.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#10.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#10.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_T_4M_C BM_T_4M_R);\n\tTissue=(T T);\n\tFactor=(4M 4M);\n\tReplicate=(2 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam);\n\tControlID=(BM_T_Inp_2 BM_T_Inp_1);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/out1.png \\\n\t\t-t BM_T_20M_C_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/Inpout1.png \\\n\t\t-t BM_T_20M_C_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/out2.png \\\n\t\t\t-t BM_T_20M_C_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/Inpout2.png \\\n\t\t\t-t BM_T_20M_C_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_T_4M BM_T_4M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 250);\n\tpaired=(PE PE);\n\tMark=(4M 4M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(BM_4M BM_4M);\n\tthisComp=${comp[0]};\n\tcell=(T T);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job4/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job13/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD20M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H4K20me3 T Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_T_20M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#8.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\techo \"BM_T_20M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#8.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\techo \"Input BM_T_20M_C_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\techo \"Input BM_T_20M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_T_20M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#8.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\techo \"BM_T_20M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#8.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\telse echo \"BM_T_20M_C\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ACTTGATG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ACTTGATG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TAGCTTGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TAGCTTGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job6/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
7: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K36me3 T Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K36me3 T Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K36me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K36me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K36me3 T Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K36me3 T Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_T_9M BM_T_9M;\n\tdir=$(pwd);\n\tcomp=(BM_9M BM_9M);\n\tthisComp=${comp[0]};\n\tcell=(T T);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#9.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#9.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#9.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#9.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#9.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#10.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#10.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#10.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#10.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(BM_T_9M_C BM_T_9M_R);\n\tTissue=(T T);\n\tFactor=(9M 9M);\n\tReplicate=(2 1);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam);\n\tControlID=(BM_T_Inp_2 BM_T_Inp_1);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/out1.png \\\n\t\t-t BM_T_36M_C_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/Inpout1.png \\\n\t\t-t BM_T_36M_C_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/out2.png \\\n\t\t\t-t BM_T_36M_C_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/Inpout2.png \\\n\t\t\t-t BM_T_36M_C_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch BM_T_9M BM_T_9M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200 250);\n\tpaired=(PE PE);\n\tMark=(9M 9M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(BM_9M BM_9M);\n\tthisComp=${comp[0]};\n\tcell=(T T);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsview/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job5/samtoolsviewInp/duplicate.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job14/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD36M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K36me3 T Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_T_36M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\techo \"BM_T_36M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\techo \"Input BM_T_36M_C_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\techo \"Input BM_T_36M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#10.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_T_36M_C_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#9.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\techo \"BM_T_36M_C_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#9.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\telse echo \"BM_T_36M_C\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a GATCAGCG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a GATCAGCG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a TAGCTTGT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a TAGCTTGT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job7/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
8: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K27me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K27me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K27me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K27me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K27me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K27me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bammerge: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch CM_B27M;\n\tdir=$(pwd);\n\tcomp=(CM_27M);\n\tthisComp=${comp[0]};\n\tcell=(B);\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam;\n\tsamtools merge -f -@ 5 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge/inputmerged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge/merged.bam ${dir}/${cell[0]}_merged.bam;\n\tln -s /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge/inputmerged.bam ${dir}/${cell[0]}_inputmerged.bam;\n\teval sample${thisComp}${cell[0]}=${dir}/${cell[0]}_merged.bam;\n\teval input${thisComp}${cell[0]}=${dir}/${cell[0]}_inputmerged.bam;\n\tdeclare -p $( echo sample${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge/var;\n\tdeclare -p $( echo input${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge/var; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bammerge/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    placeholders: 
      - bammerge
      - groupby.replicate.datasource.replicate
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bammerge.merged.bam
      - groupby.replicate.samtoolsview.duplicate.bam
      - bammerge.inputmerged.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - bammerge.merged.bam
      - bammerge.inputmerged.bam
      - bammerge.var
      - bammerge.var
      - bammerge.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#11.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#11.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#11.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#11.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#11.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#11.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#11.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/16557/16557_3#12.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/16557/16557_3#12.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/16557/16557_4#12.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/16557/16557_4#12.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/16557/16557_3#12.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/16557/16557_4#12.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/16557/16557_3#12.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bedcorrelate: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t>&2 echo \"array \\n/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak\";\n\tgappedreplicates=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak);\n\t###\n\t>&2 echo \"bedtools intersect\";\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect.bed;\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect2.bed;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"| \\\n\t\tbc >/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"| \\\n\t\tbc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect.txt;\n\t###\n\techo \"scale=4;((\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect2.bed|wc -l ) \\\n\t\t\"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect.txt; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 4
    mem: 5000
    placeholders: 
      - bedcorrelate
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.gappedintersect.bed
      - bedcorrelate.gappedintersect2.bed
      - bedcorrelate.gappedintersect.txt
      - bedcorrelate.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/CASTEiJ_indexed/CASTEiJ \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/CASTEiJ_indexed/CASTEiJ \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/CASTEiJ_indexed/CASTEiJ \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/CASTEiJ_indexed/CASTEiJ \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  chipQCmerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/chipQCmerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#create csv\n\tSampleID=(CM_B_27M_165);\n\tTissue=(B);\n\tFactor=(27M);\n\tReplicate=(2);\n\tbamReads=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam);\n\tControlID=(CM_B_Inp_2);\n\tbamControl=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam);\n\tPeaks=(/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_peaks.gappedPeak);\n\techo SampleID,Tissue,Factor,Replicate,bamReads,ControlID,bamControl,Peaks > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/chipQCmerged/sample.csv;\n\tindices=${!SampleID[*]}\n\tfor i in $indices;\n\t\tdo echo ${SampleID[i]},${Tissue[i]},${Factor[i]},${Replicate[i]},${bamReads[i]},${ControlID[i]},${bamControl[i]},${Peaks[0]} >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/chipQCmerged/sample.csv;\n\tdone\n\t#Run ChIPQC\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPQC);\n\tsamples= read.csv(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/chipQCmerged/sample.csv\", row.names=NULL);\n\tQCresults= ChIPQC(samples,consensus=T, bCount=T, annotation=\"mm10\", blacklist=\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10-blacklist.bed\");\n\tChIPQCreport(QCresults,facetBy=c(\"Factor\",\"Tissue\"));\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/chipQCmerged/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 20000
    placeholders: 
      - chipQCmerged
      - groupby.replicate.datasource.Name
      - groupby.replicate.datasource.Cell
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.repeat
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.datasource.Inp_Name
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output2
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - chipQCmerged.sample.csv
      - input.mm10-blacklist.bed
      - chipQCmerged.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/out1.png \\\n\t\t-t CM_B_27M_165_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/Inpout1.png \\\n\t\t-t CM_B_27M_165_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/out2.png \\\n\t\t\t-t CM_B_27M_165_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/Inpout2.png \\\n\t\t\t-t CM_B_27M_165_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  genic: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tsed 's/chr//g' /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/gappedPeak.bed;\n\tbedtools intersect -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/genic.bed;\n\tbedtools subtract -a /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/gappedPeak.bed -b /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/Mus_musculus.GRCm38.79.genes.chrom.gtf > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/intergenic.bed;\n\t\tR --vanilla > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/out <<-RSCRIPT\n\t\tlibrary(ggplot2)\n\t\tgenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/genic.bed\",sep=\"\\t\")\n\t\tintergenic <- read.table(\"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/intergenic.bed\",sep=\"\\t\")\n\t\tgenic_length <- genic$V3-genic$V2\n\t\tintergenic_length <- intergenic$V3-intergenic$V2\n\t\tdf <- data.frame(values =\n\t\t\tc(genic_length,intergenic_length),\n\t\t\tind=c(rep_len('genic',length(genic_length)),rep_len('intergenic',length(intergenic_length))))\n\t\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/density.pdf',width = 6, height = 4,bg = \"transparent\");\n\t\tggplot(df, aes(x=values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3) + scale_x_log10()\n\t\tdev.off\n\t\tt.test(df$values ~ df$ind)\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/genic/err"
    condition: groupby
    condition_params: 
      - replicate
    mem: 5000
    placeholders: 
      - genic
      - macsmergedbroad.output2
      - genic.gappedPeak.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.genic.bed
      - genic.gappedPeak.bed
      - input.Mus_musculus.GRCm38.79.genes.chrom.gtf
      - genic.intergenic.bed
      - genic.out
      - genic.genic.bed
      - genic.intergenic.bed
      - genic.density.pdf
      - genic.err
  macsmergedbroad: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \ttouch CM_B27M;\n\texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tsonication=(200);\n\tpaired=(PE);\n\tMark=(27M);\n\tthisMark=${Mark[0]};\n\tPD=$(eval echo \"\\$$(echo {PD$thisMark})\");\n\tcomp=(CM_27M);\n\tthisComp=${comp[0]};\n\tcell=(B);\n\t#\n\tif [ -z $PD ];then PD=${sonication[0]}; fi;\n\tif [[ ${paired[0]} == \"PE\" ]]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bedcorrelate/gappedintersect.txt); #maybe\n\tint=${last%.*};\n\tif [ $int -gt 60 ];\n\t\tthen macs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam \\\n\t\t-c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam -f $paired -g mm \\\n\t\t-n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.05 --nomodel --extsize ${PD} --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/FoldE.bdg -m FE\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/FoldE.bdg -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/logLR.bdg -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/logLR.bdg -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\t\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t\t###\n\t\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_model.r;\n\t\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_peaks.broadPeak broadout;\n\t\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_peaks.gappedPeak gappedout;\n\t\t###\n\t\t# Save required data as variables\n\t\t###\n\t\teval treat${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_treat_pileup.bdg;\n\t\teval cont${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_control_lambda.bdg;\n\t\teval xls${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_peaks.xls;\n\t\teval peak${thisComp}${cell[0]}=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_peaks.gappedPeak;\n\t\tdeclare -p $( echo treat${thisComp}${cell[0]}) > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/var;\n\t\tdeclare -p $( echo cont${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/var;\n\t\tdeclare -p $( echo xls${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/var;\n\t\tdeclare -p $( echo peak${thisComp}${cell[0]}) >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/var;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/err"
    condition: groupby
    condition_params: 
      - replicate
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsmergedbroad
      - groupby.replicate.datasource.replicate
      - predictfragment.out
      - groupby.replicate.datasource.sonication
      - groupby.replicate.datasource.SE_PE
      - groupby.replicate.datasource.Mark
      - groupby.replicate.datasource.comp
      - groupby.replicate.datasource.Cell
      - bedcorrelate.gappedintersect.txt
      - groupby.replicate.samtoolsview.duplicate.bam
      - groupby.replicate.samtoolsviewInp.duplicate.bam
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.FoldE.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.logLR.bdg
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.FoldE.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.logLR.bdg
      - input.mm10.len
      - macsmergedbroad.output3
      - macsmergedbroad.output1
      - macsmergedbroad.output2
      - macsmergedbroad.output4
      - macsmergedbroad.output5
      - macsmergedbroad.output8
      - macsmergedbroad.output2
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.var
      - macsmergedbroad.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD27M};\n\tif [ -z \"$PD\" ];then PD=200; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  piemerged: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/piemerged;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/macsmergedbroad/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/piemerged/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(ggplot2);\n\tlibrary(RColorBrewer);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/piemerged/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/piemerged/pie.pdf',width = 6, height = 4,bg = \"transparent\");\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/piemerged/bar.pdf',width = 6, height = 4,bg = \"transparent\");\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab(\"Feature\") + ylab(\"Frequency\xE2\x80\x9D);   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/piemerged/err"
    condition: groupby
    condition_params: 
      - replicate
    placeholders: 
      - piemerged
      - macsmergedbroad.output2
      - piemerged.gapped.bed.gz
      - piemerged.gapped.bed.gz
      - piemerged.pie.pdf
      - piemerged.bar.pdf
      - piemerged.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K27me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"CM_B_27M_165_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#11.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\techo \"CM_B_27M_165_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#11.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\techo \"Input CM_B_27M_165_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_3#12.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\techo \"Input CM_B_27M_165_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\tiget -K /seq/16557/16557_4#12.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"CM_B_27M_165_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_3#11.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\techo \"CM_B_27M_165_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/16557/16557_4#11.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\telse echo \"CM_B_27M_165\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a GGCTACAG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a GGCTACAG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a CTTGTACT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a CTTGTACT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job8/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
9: 
  annotatepeaks: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaks;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam            \\\n\t\t-T \"H3K4me3 B Cell\" -O out -L 3000 -GO km -KNC ${clusters} \\\n\t\t-CO blue:white:red -P 5 -FI 1;\n\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/software/ExtractGeneClusterings.r out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam\tout.cluster${i}.txt\t\\\n\t\t\t\\\"H3K4me3 B Cell Cluster${i}\\\"\"              \\\n\t\t\t>> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaks/config.txt;\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaks/config.txt -O clusters -L 3000 -GO hc \\\n\t\t-CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaks/configB.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/B_ordered_TPM.txt\t\\\n\t\t\"H3K4me3 B cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaks/configB.txt -O TPMorderedB -L 3000    \\\n\t\t-GO none -CO blue:white:red -P 5;\n\techo > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaks/configT.txt <<-EOF\n\t\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam\t/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/T_ordered_TPM.txt\t\\\n\t\t\"H3K4me3 T cell\"\n\tEOF\n\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaks/configT.txt -O TPMorderedT -L 3000 -GO none \\\n\t\t-CO blue:white:red -P 5; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaks/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - annotatepeaks
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - software.ExtractGeneClusterings.r
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaks.config.txt
      - annotatepeaks.config.txt
      - annotatepeaks.configB.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.B_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configB.txt
      - annotatepeaks.configT.txt
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - input.T_ordered_TPM.txt
      - datasource.mark_full
      - annotatepeaks.configT.txt
      - annotatepeaks.err
  annotatepeaksgroup: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaksgroup;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam \\\n\t\t-T \"H3K4me3 B Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"H3K4me3 B Cell\" \\\n\t\t\t-L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaksgroup/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - cluster.4.RData
    placeholders: 
      - annotatepeaksgroup
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - datasource.mark_full
      - datasource.Cell
      - annotatepeaksgroup.err
  bamtofq: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#1.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_1_lane_1.fastq \\\n\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#1.cram - | bamtofastq inputformat=cram \\\n\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#1.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t\tF2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#1.cram - | bamtofastq inputformat=cram \\\n\t\t\t\t#exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_2.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_2.fq;\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_1_lane_1.fastq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/read_2_lane_1.fastq;\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#1.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#1.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/merged.bam gz=1 \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#1.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofq
      - datasource.datatype
      - datasource.SE_PE
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_2_lane_1.fastq
      - datasource.Lane1
      - bamtofq.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_2_lane_2.fastq
      - datasource.Lane2
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.read_1_lane_2.fastq
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.read_2_lane_2.fastq
      - bamtofq.out_2.fq
      - bamtofq.out_1.fq
      - bamtofq.out_1.fq.gz
      - bamtofq.out_1.fq
      - datasource.SE_PE
      - bamtofq.out_2.fq
      - bamtofq.out_2.fq.gz
      - bamtofq.out_2.fq
      - bamtofq.read_1_lane_1.fastq
      - bamtofq.out_1.fq.gz
      - bamtofq.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofq.read_2_lane_1.fastq
      - bamtofq.out_2.fq.gz
      - bamtofq.read_2_lane_1.fastq
      - datasource.datatype
      - datasource.Lane1
      - bamtofq.lane1.bam
      - datasource.multi_lane
      - datasource.Lane2
      - bamtofq.lane2.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.lane2.bam
      - bamtofq.lane1.bam
      - bamtofq.merged.bam
      - bamtofq.lane1.bam
      - datasource.SE_PE
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - bamtofq.merged.bam
      - bamtofq.merged.bam
      - bamtofq.out_1.fq.gz
      - bamtofq.merged.bam
      - datasource.Lane1
      - bamtofq.out_1.fq.gz
      - bamtofq.err
  bamtofqinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t###CRAM\n\tif [ cram == \"cram\" ];\n\t\tthen if [ PE == \"PE\" ];\n\t\t\tthen iget -K /seq/15449/15449_1#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_1_lane_1.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_2_lane_1.fastq;\n\t\telse iget -K /seq/15449/15449_1#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_1_lane_1.fastq ;\n\t\tfi;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen if [ PE == \"PE\" ];\n\t\t\t\tthen iget -K /seq/15449/15449_2#9.cram - | \\\n\t\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_1_lane_2.fastq F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_2_lane_2.fastq;\n\t\t\telse iget -K /seq/15449/15449_2#9.cram - | \\\n\t\t\t\tbamtofastq inputformat=cram \\ #exclude=SECONDARY,SUPPLEMENTARY,QCFAIL \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_1_lane_2.fastq ;\n\t\t\tfi;\n\t\t\tcat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_1_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_1_lane_2.fastq \\\n\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_2_lane_1.fastq /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_2_lane_2.fastq \\\n\t\t\t\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_2.fq;\n\t\t\tfi;\n\t\t\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq;\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_2.fq; > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm\n\t\t\tfi;\n\t\telse gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_1_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_1_lane_1.fastq\n\t\t\tif [ PE == \"PE\" ];\n\t\t\t\tthen gzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_2_lane_1.fastq > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_2.fq.gz;\n\t\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/read_2_lane_1.fastq\n\t\t\tfi;\n\t\tfi;\n\t###Â BAM\n\telif [ cram == \"bam\" ];\n\t\tthen samtools sort /seq/15449/15449_1#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/lane1.bam;\n\t\tif [ TRUE == \"TRUE\" ];\n\t\t\tthen samtools sort /seq/15449/15449_2#9.cram -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/lane2.bam;\n\t\t\tsamtools merge /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/merged.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/lane2.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/lane1.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/lane2.bam;\n\t\telse cat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/lane1.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/merged.bam;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/lane1.bam;\n\t\tfi;\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bamtofastq filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/merged.bam gz=1 \\\n\t\t\t\tF=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq.gz F2=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_2.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/merged.bam;\n\t\telse\n\t\t\tbamtofastq gz=1 filename=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/merged.bam > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq.gz;\n\t\t\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/merged.bam;\n\t\tfi;\n\telse\n\t\tcat /seq/15449/15449_1#9.cram* > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq.gz;\n\tfi\n\trm *.fastq *.fq || >&2 echo \"no uncompressed FASTQ files to remove\"; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/err"
    condition: ~
    mem: 1500
    placeholders: 
      - bamtofqinp
      - datasource.Inp_datatype
      - datasource.SE_PE
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_lane1
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.multi_lane
      - datasource.SE_PE
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - datasource.Inp_lane2
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.read_1_lane_2.fastq
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.read_2_lane_2.fastq
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_1.fq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_1.fq
      - datasource.SE_PE
      - bamtofqinp.out_2.fq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.read_1_lane_1.fastq
      - datasource.SE_PE
      - bamtofqinp.read_2_lane_1.fastq
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.read_2_lane_1.fastq
      - datasource.Inp_datatype
      - datasource.Inp_lane1
      - bamtofqinp.lane1.bam
      - datasource.multi_lane
      - datasource.Inp_lane2
      - bamtofqinp.lane2.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.lane2.bam
      - bamtofqinp.lane1.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.lane1.bam
      - datasource.SE_PE
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - bamtofqinp.merged.bam
      - bamtofqinp.merged.bam
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.merged.bam
      - datasource.Inp_lane1
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.err
  bowtie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen >&2 echo \"paired end\";\n\t\t\t\tbowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgalore/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgalore/out_2_val_2.fq.gz) \\\n\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse >&2 echo \"single end\";\n\t\t\tbowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgalore/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtie
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - trimgalore.output4
      - bowtie.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgalore.output2
      - bowtie.out.sam
      - bowtie.out.sam
      - bowtie.out.sorted.bam
      - bowtie.out.sorted.bam
      - bowtie.out.sam
      - bowtie.err
  bowtieinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_build/touch /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/bowtie_buildcast/touch;\n\tset +o posix;\n\tbash <<-EOF\n\t\tif [ PE == \"PE\" ];\n\t\t\tthen bowtie2 -p 12 -x \\\n\t\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t\t\t-1 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgaloreinp/out_1_val_1.fq.gz) -2 <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgaloreinp/out_2_val_2.fq.gz) \\\n\t\t\t\t\t-S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sam -I 99 -X 1000 --no-discordant --no-unal;\n\t\telse bowtie2 -p 12 -x \\\n\t\t\t/lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J \\\n\t\t\t-U <(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgaloreinp/out_1_val_1.fq.gz) -S /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sam --no-unal;\n\t\tfi;\n\tEOF\n\tsamtools view -hSb /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sam | samtools sort -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sorted.bam -@ 5 -m 25G -T tmp.sort && samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sorted.bam;\n\trm /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sam; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/err"
    condition: ~
    cores: 14
    mem: 30000
    outputfiles: 
      - out.sorted.bam.bai
    placeholders: 
      - bowtieinp
      - bowtie_build.touch
      - bowtie_buildcast.touch
      - datasource.SE_PE
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - trimgaloreinp.output4
      - bowtieinp.out.sam
      - datasource.Strain
      - datasource.Strain
      - trimgaloreinp.output2
      - bowtieinp.out.sam
      - bowtieinp.out.sam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sorted.bam
      - bowtieinp.out.sam
      - bowtieinp.err
  fastquality: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgalore/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/out1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/out1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/out1.png \\\n\t\t-t BM_B_4M_R_read1;\n\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgaloreinp/out_1_val_1.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/Inpout1;\n\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/Inpout1 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/Inpout1.png \\\n\t\t-t BM_B_4M_R_input_read1;\n\tif [ PE == \"PE\" ];\n\tthen gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgalore/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/out2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/out2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/out2.png \\\n\t\t\t-t BM_B_4M_R_read2;\n\t\tgunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgaloreinp/out_2_val_2.fq.gz | fastx_quality_stats -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/Inpout2;\n\t\tfastq_quality_boxplot_graph.sh -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/Inpout2 -o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/Inpout2.png \\\n\t\t\t-t BM_B_4M_R_input_read2;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/fastquality/err"
    condition: ~
    mem: 50
    placeholders: 
      - fastquality
      - trimgalore.output2
      - fastquality.out1
      - fastquality.out1
      - fastquality.out1.png
      - datasource.Name
      - trimgaloreinp.output2
      - fastquality.Inpout1
      - fastquality.Inpout1
      - fastquality.Inpout1.png
      - datasource.Name
      - datasource.SE_PE
      - trimgalore.output4
      - fastquality.out2
      - fastquality.out2
      - fastquality.out2.png
      - datasource.Name
      - trimgaloreinp.output4
      - fastquality.Inpout2
      - fastquality.Inpout2
      - fastquality.Inpout2.png
      - datasource.Name
      - fastquality.err
  macsunmergedbroadpeak: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \texport PYENV_VERSION=2.7.10;\n\tsource /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job0/predictfragment/out;\n\tPD=${PD4M};\n\tif [ -z \"$PD\" ];then PD=250; fi;\n\tif [ PE == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam \\\n\t\t-f $paired -g mm -n ChIPseqout -B -q 0.05 --broad --broad-cutoff 0.1      \\\n\t\t--keep-dup auto --nomodel --extsize ${PD};\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/FoldE.bdg -m FE\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/FoldE.bdg -m FE;\n\t>&2 echo \"macs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_treat_pileup.bdg -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_control_lambda.bdg \\\n\t\t-o /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/logLR.bdg -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/FoldE.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"bdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len\";\n\tbdg2bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/logLR.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len;\n\t>&2 echo \"Rscript\";\n\tRscript /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_model.r;\n\tbroadpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak broadout;\n\tgappedpeak.py /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak gappedout;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_peaks.broadPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/broad.bdg;\n\tbedtools genomecov -i /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak -g /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/input/mm10.len -bg \\\n\t\t> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/gapped.bdg; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/err"
    condition: ~
    cores: 5
    mem: 5000
    outputfiles: 
      - ChIPseqout_peaks.broadPeak
      - ChIPseqout_peaks.gappedPeak
      - ChIPseqout_model.r
      - ChIPseqout_treat_pileup.bdg
      - ChIPseqout_control_lambda.bdg
      - FoldE.bw
      - logLR.bw
      - ChIPseqout_peaks.xls
    placeholders: 
      - macsunmergedbroadpeak
      - predictfragment.out
      - datasource.Mark
      - datasource.sonication
      - datasource.SE_PE
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.FoldE.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.output4
      - macsunmergedbroadpeak.output5
      - macsunmergedbroadpeak.logLR.bdg
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.FoldE.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.logLR.bdg
      - input.mm10.len
      - macsunmergedbroadpeak.output3
      - macsunmergedbroadpeak.output1
      - macsunmergedbroadpeak.output2
      - macsunmergedbroadpeak.output1
      - input.mm10.len
      - macsunmergedbroadpeak.broad.bdg
      - macsunmergedbroadpeak.output2
      - input.mm10.len
      - macsunmergedbroadpeak.gapped.bdg
      - macsunmergedbroadpeak.err
  pie: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/pie;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \t#gapped broad output\n\tgzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/macsunmergedbroadpeak/ChIPseqout_peaks.gappedPeak > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/pie/gapped.bed.gz;\n\tR --vanilla <<-RSCRIPT\n\tlibrary(ChIPseeker);\n\tlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tlibrary(RColorBrewer);\n\tlibrary(ggplot2);\n\tpar(mfrow=c(1,1));\n\tfile<-'/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/pie/gapped.bed.gz';\n\tpeakAnno <- annotatePeak(file, tssRegion=c(-3000, 3000),TxDb=TxDb.Mmusculus.UCSC.mm10.knownGene);\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/pie/pie.pdf',width = 7, height = 4,bg = 'transparent');\n\tplotAnnoPie(peakAnno);\n\tdev.off();\n\twrite(peakAnno@annoStat$Feature, stderr())\n\tcolourCount = length(peakAnno@annoStat$Feature);\n\tgetPalette = colorRampPalette(brewer.pal(9, \"Set1\"));\n\twrite(colourCount, stderr())\n\tpdf('/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/pie/bar.pdf',width = 16, height = 4,bg = 'transparent');\n\tggplot(peakAnno@annoStat, aes(Feature, Frequency, fill=Feature)) + geom_bar(stat=\"identity\") +\n\tscale_fill_manual(values = getPalette(colourCount)) + xlab('Feature') + ylab('Frequency');   #Barplot\n\tdev.off();\n\tRSCRIPT\n\t: 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/pie/err"
    condition: ~
    mem: 5000
    placeholders: 
      - pie
      - macsunmergedbroadpeak.output2
      - pie.gapped.bed.gz
      - pie.gapped.bed.gz
      - pie.pie.pdf
      - pie.bar.pdf
      - pie.err
  samtoolsview: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam M=metrics index=1 markthreads=4;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtie/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsview
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - bowtie.out.sorted.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.duplicate.bam
      - samtoolsview.err
  samtoolsviewInp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tbammarkduplicates I=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sorted.bam O=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam M=metrics index=1 markthreads=4;\n\t#/software/team131/bin/MarkDuplicates.jar INPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sorted.bam OUTPUT=/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam M=metrics;\n\t#samtools index /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam;\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bowtieinp/out.sorted.bam>tmp1\n\tsamtools idxstats /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam>tmp2\n\tif [ ! -z \"$(diff tmp1 tmp2)\" ];\n\tthen exit 113; #throw Error if read numbers in output don't match input\n\tfi\n\tduplication=$(samtools flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam | grep 'duplicates' | cut -f 1 -d ' ');\n\tif [ \"$duplication\" == \"0\" ];\n\tthen exit 114; # throw Error if no duplication\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/err"
    condition: ~
    cores: 5
    mem: 30000
    outputfiles: 
      - duplicate.bam.bai
    placeholders: 
      - samtoolsviewInp
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - bowtieinp.out.sorted.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - samtoolsviewInp.err
  seperateclusters: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/seperateclusters;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tclusters=4;\n\tcp /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/annotatepeaksgroup/cluster.4.RData /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/seperateclusters/clusters.RData;\n\tExtractGName.R /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/seperateclusters/clusters.RData;\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsview/duplicate.bam:/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/samtoolsviewInp/duplicate.bam\tclusters.1.cluster${i}.txt\t\\\"H3K4me3 B Cell\\\"\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/seperateclusters/config.txt;\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/seperateclusters/config.txt -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/seperateclusters/config.txt -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/seperateclusters/err"
    condition: ~
    cores: 5
    mem: 5000
    placeholders: 
      - seperateclusters
      - annotatepeaksgroup.output1
      - seperateclusters.clusters.RData
      - seperateclusters.clusters.RData
      - samtoolsview.duplicate.bam
      - samtoolsviewInp.duplicate.bam
      - datasource.mark_full
      - datasource.Cell
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.config.txt
      - seperateclusters.err
  summarystats: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ cram == \"cram\" ];\n\t\tthen echo \"BM_B_4M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#1.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\techo \"BM_B_4M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#1.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\techo \"Input BM_B_4M_R_lane1\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_1#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\techo \"Input BM_B_4M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\tiget -K /seq/15449/15449_2#9.cram - | samtools view -h - | \\\n\t\t\tsamtools flagstat - >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\telif [ cram == \"bam\" ];\n\t\tthen echo \"BM_B_4M_R_lane1\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_1#1.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\techo \"BM_B_4M_R_lane2\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\tsamtools flagstat /seq/15449/15449_2#1.cram >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\telse echo \"BM_B_4M_R\" > /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\t\techo \"FastQ\" >> /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/out.flagstat;\n\tfi; 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/summarystats/err"
    condition: ~
    mem: 1000
    placeholders: 
      - summarystats
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Inp_lane2
      - summarystats.out.flagstat
      - datasource.datatype
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane1
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - datasource.Lane2
      - summarystats.out.flagstat
      - datasource.Name
      - summarystats.out.flagstat
      - summarystats.out.flagstat
      - summarystats.err
  trimgalore: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgalore;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a ATCACGTT \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a ATCACGTT \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofq/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgalore/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgalore
      - bamtofq.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - bamtofq.out_2.fq.gz
      - datasource.Tag
      - bamtofq.out_1.fq.gz
      - trimgalore.err
  trimgaloreinp: 
    cmd: "cd /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgaloreinp;  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tlength=$(gunzip -c /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq.gz | head -2| tail -1 | wc -c);\n\tlength=$(expr $length \\* 9 / 10); #10% cutoff\n\tif [ PE == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a GATCAGCG \\\n\t\t\t--stringency 4 --trim1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_2.fq.gz;\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a GATCAGCG \\\n\t\t\t--stringency 4 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/bamtofqinp/out_1.fq.gz;\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>/lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/output/run2/job9/trimgaloreinp/err"
    condition: ~
    cores: 3
    mem: 2000
    outputfiles: 
      - out_1.fq.gz_trimming_report.txt
      - out_1_val_1.fq.gz
      - out_2.fq.gz_trimming_report.txt
      - out_2_val_2.fq.gz
      - out_1_val_1.html
      - out_1_val_1.zip
      - out_2_val_2.html
      - out_2_val_2.zip
    placeholders: 
      - trimgaloreinp
      - bamtofqinp.out_1.fq.gz
      - datasource.SE_PE
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - bamtofqinp.out_2.fq.gz
      - datasource.Inp_Tag
      - bamtofqinp.out_1.fq.gz
      - trimgaloreinp.err
