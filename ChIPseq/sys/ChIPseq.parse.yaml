--- 
annotatepeaks: 
  cmd: "cd [% annotatepeaks %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\tls * | grep -v err | xargs rm -rf;\n\ttrap SomeErrorHandler ERR;\n\tclusters=4\n\tngs.plot.r -G mm10 -R genebody -C [% samtoolsview.output1 %]:[% samtoolsviewInp.output1 %] -T \"[% datasource.mark_full %] [% datasource.Cell %] Cell\" -O out -L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5 -FI 1;\n\t[% software.ExtractGeneClusterings.r %] out;\n\tfor i in $(seq 1 ${clusters});\n\tdo\n\t\techo -e \"[% samtoolsview.output1 %]:[% samtoolsviewInp.output1 %]\tout.cluster${i}.txt\t\\\"[% datasource.mark_full %] [% datasource.Cell %] Cell Cluster${i}\\\"\" >> [% annotatepeaks.config.txt %];\n\tdone\n\tngs.plot.r -G mm10 -R genebody -C [% annotatepeaks.config.txt %] -O clusters -L 3000 -GO hc -CO blue:white:red -P 5;\n\tcat > [% annotatepeaks.configB.txt %] << EOF\n[% samtoolsview.output1 %]:[% samtoolsviewInp.output1 %]\t[% input.B_ordered_TPM.txt %]\t\"[% datasource.mark_full %] B cell\"\nEOF\n\tngs.plot.r -G mm10 -R genebody -C [% annotatepeaks.configB.txt %] -O TPMorderedB -L 3000 -GO none -CO blue:white:red -P 5;\n\tcat > [% annotatepeaks.configT.txt %] << EOF\n[% samtoolsview.output1 %]:[% samtoolsviewInp.output1 %]\t[% input.T_ordered_TPM.txt %]\t\"[% datasource.mark_full %] T cell\"\nEOF\n\tngs.plot.r -G mm10 -R genebody -C [% annotatepeaks.configT.txt %] -O TPMorderedT -L 3000 -GO none -CO blue:white:red -P 5; 2>[% annotatepeaks.err %]"
  condition: ~
  cores: 5
  mem: 5000
  placeholders: 
    - annotatepeaks
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - datasource.mark_full
    - datasource.Cell
    - software.ExtractGeneClusterings.r
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - datasource.mark_full
    - datasource.Cell
    - annotatepeaks.config.txt
    - annotatepeaks.config.txt
    - annotatepeaks.configB.txt
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - input.B_ordered_TPM.txt
    - datasource.mark_full
    - annotatepeaks.configB.txt
    - annotatepeaks.configT.txt
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - input.T_ordered_TPM.txt
    - datasource.mark_full
    - annotatepeaks.configT.txt
    - annotatepeaks.err
annotatepeaksgroup: 
  cmd: "cd [% annotatepeaksgroup %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\tls * | grep -v err | xargs rm -rf;\n\ttrap SomeErrorHandler ERR;\n\tngs.plot.r -G mm10 -R genebody -C [% samtoolsview.output1 %]:[% samtoolsviewInp.output1 %] -T \"[% datasource.mark_full %] [% datasource.Cell %] Cell\" -O out -L 3000 -CO blue:white:red -P 5 -FI 0;\n\tfor clusters in {4..10};\n\t\tdo name=\"cluster.${clusters}\";\n\t\treplot.r heatmap -I out.zip -O ${name} -T \"[% datasource.mark_full %] [% datasource.Cell %] Cell\" -L 3000 -GO km -KNC ${clusters} -CO blue:white:red -P 5;\n\t\tExtractGName.R ${name}.RData;\n\tdone 2>[% annotatepeaksgroup.err %]"
  condition: ~
  cores: 5
  mem: 5000
  outputfiles: 
    - cluster.4.RData
  placeholders: 
    - annotatepeaksgroup
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - datasource.mark_full
    - datasource.Cell
    - datasource.mark_full
    - datasource.Cell
    - annotatepeaksgroup.err
bamcorrelate: 
  cmd: cd [% bamcorrelate %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;	bamCorrelate bins -b [% jobs.samtoolsview.output1 %] -o heatmap.pdf --corMethod pearson --labels [% jobs.datasource.replicate %] --colorMap Reds --zMin 0.5 --zMax 1 -o correlation_spearman.pdf; 2>[% bamcorrelate.err %]
  condition: once
  cores: 16
  mem: 5000
  placeholders: 
    - bamcorrelate
    - jobs.samtoolsview.output1
    - jobs.datasource.replicate
    - bamcorrelate.err
bamtofq: 
  cmd: "cd [% bamtofq %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;trap SomeErrorHandler ERR;\tif [ [% datasource.bam %] == \"TRUE\" ];\n\t\tthen samtools sort [% datasource.location %]_1.bam [% bamtofq.lane1 %];\n\t\tsamtools sort [% datasource.location %]_2.bam [% bamtofq.lane2 %];\n\t\tsamtools merge [% bamtofq.merged.bam %] [% bamtofq.lane1 %].bam [% bamtofq.lane2 %].bam;\n\t\trm [% bamtofq.lane1 %].bam [% bamtofq.lane2 %].bam;\n\t\tif [ [% datasource.SE_PE %] == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq filename=[% bamtofq.merged.bam %] gz=1 F=[% bamtofq.out_1.fq.gz %] F2=[% bamtofq.out_2.fq.gz %];\n\t\t\t\trm [% bamtofq.merged.bam %];\n\t\t\telse\n\t\t\t\tbamtofastq gz=1 filename=[% bamtofq.merged.bam %] > [% bamtofq.out_1.fq.gz %];\n\t\t\t\trm [% bamtofq.merged.bam %];\n\t\t\tfi;\n\t\telse\n\t\t\tcat [% datasource.location %]* > [% bamtofq.out_1.fq.gz %];\n\t\tfi 2>[% bamtofq.err %]"
  condition: ~
  mem: 1500
  placeholders: 
    - bamtofq
    - datasource.bam
    - datasource.location
    - bamtofq.lane1
    - datasource.location
    - bamtofq.lane2
    - bamtofq.merged.bam
    - bamtofq.lane1
    - bamtofq.lane2
    - bamtofq.lane1
    - bamtofq.lane2
    - datasource.SE_PE
    - bamtofq.merged.bam
    - bamtofq.out_1.fq.gz
    - bamtofq.out_2.fq.gz
    - bamtofq.merged.bam
    - bamtofq.merged.bam
    - bamtofq.out_1.fq.gz
    - bamtofq.merged.bam
    - datasource.location
    - bamtofq.out_1.fq.gz
    - bamtofq.err
bamtofqinp: 
  cmd: "cd [% bamtofqinp %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;trap SomeErrorHandler ERR;\tif [ [% datasource.Inp_bam %] == \"TRUE\" ];\n\t\tthen samtools sort [% datasource.Inp_location %]_1.bam [% bamtofqinp.lane1 %];\n\t\tsamtools sort [% datasource.Inp_location %]_2.bam [% bamtofqinp.lane2 %];\n\t\tsamtools merge [% bamtofqinp.merged.bam %] [% bamtofqinp.lane1 %].bam [% bamtofqinp.lane2 %].bam;\n\t\trm [% bamtofqinp.lane1 %].bam [% bamtofqinp.lane2 %].bam;\n\t\tif [ [% datasource.SE_PE %] == \"PE\" ];\n\t\t\tthen\n\t\t\t\tbamtofastq gz=1 filename=[% bamtofqinp.merged.bam %] F=[% bamtofqinp.out_1.fq.gz %] F2=[% bamtofqinp.out_2.fq.gz %];\n\t\t\t\trm [% bamtofqinp.merged.bam %];\n\t\t\telse bamtofastq gz=1 filename=[% bamtofqinp.merged.bam %] > [% bamtofqinp.out_1.fq.gz %];\n\t\t\t\trm [% bamtofqinp.merged.bam %];\n\t\tfi;\n\telse cat [% datasource.Inp_location %]* > [% bamtofqinp.out_1.fq.gz %];\n\tfi 2>[% bamtofqinp.err %]"
  condition: ~
  mem: 1500
  placeholders: 
    - bamtofqinp
    - datasource.Inp_bam
    - datasource.Inp_location
    - bamtofqinp.lane1
    - datasource.Inp_location
    - bamtofqinp.lane2
    - bamtofqinp.merged.bam
    - bamtofqinp.lane1
    - bamtofqinp.lane2
    - bamtofqinp.lane1
    - bamtofqinp.lane2
    - datasource.SE_PE
    - bamtofqinp.merged.bam
    - bamtofqinp.out_1.fq.gz
    - bamtofqinp.out_2.fq.gz
    - bamtofqinp.merged.bam
    - bamtofqinp.merged.bam
    - bamtofqinp.out_1.fq.gz
    - bamtofqinp.merged.bam
    - datasource.Inp_location
    - bamtofqinp.out_1.fq.gz
    - bamtofqinp.err
bedcorrelate: 
  cmd: "cd [% bedcorrelate %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tbroadreplicates=([% groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.broadPeak %]);\n\tgappedreplicates=([% groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak %]);\n\tnarrowreplicates=([% groupby.replicate.macsunmergednarrowpeak.ChIPseqout_peaks.narrowPeak %]);\n\t###\n\tbedtools intersect -u -a ${broadreplicates[0]} -b ${broadreplicates[1]} > [% bedcorrelate.broadintersect.bed %];\n\tbedtools intersect -u -a ${gappedreplicates[0]} -b ${gappedreplicates[1]} > [% bedcorrelate.gappedintersect.bed %];\n\tbedtools intersect -u -a ${narrowreplicates[0]} -b ${narrowreplicates[1]} > [% bedcorrelate.narrowintersect.bed %];\n\tbedtools intersect -u -a ${broadreplicates[1]} -b ${broadreplicates[0]} > [% bedcorrelate.broadintersect2.bed %];\n\tbedtools intersect -u -a ${gappedreplicates[1]} -b ${gappedreplicates[0]} > [% bedcorrelate.gappedintersect2.bed %];\n\tbedtools intersect -u -a ${narrowreplicates[1]} -b ${narrowreplicates[0]} > [% bedcorrelate.narrowintersect2.bed %];\n\t###\n\techo \"scale=4;(\" $(cat [% bedcorrelate.broadintersect.bed %]|wc -l ) \"/\" $(cat ${broadreplicates[0]} |wc -l ) \") *100\"|bc >[% bedcorrelate.broadintersect.txt %];\n\techo \"scale=4;(\" $(cat [% bedcorrelate.gappedintersect.bed %]|wc -l ) \"/\" $(cat ${gappedreplicates[0]} |wc -l ) \") *100\"|bc >[% bedcorrelate.gappedintersect.txt %];\n\techo \"scale=4;(\" $(cat [% bedcorrelate.narrowintersect.bed %]|wc -l ) \"/\" $(cat ${narrowreplicates[0]} |wc -l ) \") *100\"|bc >[% bedcorrelate.narrowintersect.txt %];\n\t###\n\techo \"scale=4;(\" $(cat [% bedcorrelate.broadintersect2.bed %]|wc -l ) \"/\" $(cat ${broadreplicates[1]} |wc -l ) \") *100\"|bc >>[% bedcorrelate.broadintersect.txt %];\n\techo \"scale=4;(\" $(cat [% bedcorrelate.gappedintersect2.bed %]|wc -l ) \"/\" $(cat ${gappedreplicates[1]} |wc -l ) \") *100\"|bc >>[% bedcorrelate.gappedintersect.txt %];\n\techo \"scale=4;(\" $(cat [% bedcorrelate.narrowintersect2.bed %]|wc -l ) \"/\" $(cat ${narrowreplicates[1]} |wc -l ) \") *100\"|bc >>[% bedcorrelate.narrowintersect.txt %];\n\t###\n\techo \"scale=4;((\" $(cat [% bedcorrelate.broadintersect.bed %]|wc -l ) \"/\" $(cat ${broadreplicates[0]} |wc -l ) \")+(\" $(cat [% bedcorrelate.broadintersect2.bed %]|wc -l ) \"/\" $(cat ${broadreplicates[1]} |wc -l ) \")) *50\"|bc >>[% bedcorrelate.broadintersect.txt %];\n\techo \"scale=4;((\" $(cat [% bedcorrelate.gappedintersect.bed %]|wc -l ) \"/\" $(cat ${gappedreplicates[0]} |wc -l ) \")+(\" $(cat [% bedcorrelate.gappedintersect2.bed %]|wc -l ) \"/\" $(cat ${gappedreplicates[1]} |wc -l ) \")) *50\"|bc >>[% bedcorrelate.gappedintersect.txt %];\n\techo \"scale=4;((\" $(cat [% bedcorrelate.narrowintersect.bed %]|wc -l ) \"/\" $(cat ${narrowreplicates[0]} |wc -l ) \")+(\" $(cat [% bedcorrelate.narrowintersect2.bed %]|wc -l ) \"/\" $(cat ${narrowreplicates[1]} |wc -l ) \")) *50\"|bc >>[% bedcorrelate.narrowintersect.txt %]; 2>[% bedcorrelate.err %]"
  condition: groupby
  condition_params: 
    - replicate
  cores: 4
  mem: 5000
  placeholders: 
    - bedcorrelate
    - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.broadPeak
    - groupby.replicate.macsunmergedbroadpeak.ChIPseqout_peaks.gappedPeak
    - groupby.replicate.macsunmergednarrowpeak.ChIPseqout_peaks.narrowPeak
    - bedcorrelate.broadintersect.bed
    - bedcorrelate.gappedintersect.bed
    - bedcorrelate.narrowintersect.bed
    - bedcorrelate.broadintersect2.bed
    - bedcorrelate.gappedintersect2.bed
    - bedcorrelate.narrowintersect2.bed
    - bedcorrelate.broadintersect.bed
    - bedcorrelate.broadintersect.txt
    - bedcorrelate.gappedintersect.bed
    - bedcorrelate.gappedintersect.txt
    - bedcorrelate.narrowintersect.bed
    - bedcorrelate.narrowintersect.txt
    - bedcorrelate.broadintersect2.bed
    - bedcorrelate.broadintersect.txt
    - bedcorrelate.gappedintersect2.bed
    - bedcorrelate.gappedintersect.txt
    - bedcorrelate.narrowintersect2.bed
    - bedcorrelate.narrowintersect.txt
    - bedcorrelate.broadintersect.bed
    - bedcorrelate.broadintersect2.bed
    - bedcorrelate.broadintersect.txt
    - bedcorrelate.gappedintersect.bed
    - bedcorrelate.gappedintersect2.bed
    - bedcorrelate.gappedintersect.txt
    - bedcorrelate.narrowintersect.bed
    - bedcorrelate.narrowintersect2.bed
    - bedcorrelate.narrowintersect.txt
    - bedcorrelate.err
bowtie: 
  cmd: "cd [% bowtie %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tls [% bowtie_build.touch %] [% bowtie_buildcast.touch %];\n\tif [ [% datasource.SE_PE %] == \"PE\" ];\n\t\tthen [% software.bowtierun %] -p [% datasource.SE_PE %] -1 [% trimgalore.output2 %] -2 [% trimgalore.output4 %] -o [% bowtie.out.sam %] -s [% datasource.Strain %];\n\telse [% software.bowtierun %] -p [% datasource.SE_PE %] -1 [% trimgalore.output2 %] -o [% bowtie.out.sam %] -s [% datasource.Strain %];\n\tfi 2>[% bowtie.err %]"
  condition: ~
  cores: 14
  mem: 7000
  placeholders: 
    - bowtie
    - bowtie_build.touch
    - bowtie_buildcast.touch
    - datasource.SE_PE
    - software.bowtierun
    - datasource.SE_PE
    - trimgalore.output2
    - trimgalore.output4
    - bowtie.out.sam
    - datasource.Strain
    - software.bowtierun
    - datasource.SE_PE
    - trimgalore.output2
    - bowtie.out.sam
    - datasource.Strain
    - bowtie.err
bowtie_build: 
  cmd: "cd [% bowtie_build %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;trap SomeErrorHandler ERR; gunzip -f /lustre/scratch109/sanger/rg12/genome/C57BL6J/mm10_C57BL6.fa.gz;\tbowtie2-build -f /lustre/scratch109/sanger/rg12/genome/C57BL6J/mm10_C57BL6.fa /lustre/scratch109/sanger/rg12/genome/C57BL6J_indexed/C57BL6J;\n\tgzip /lustre/scratch109/sanger/rg12/genome/C57BL6J/mm10_C57BL6.fa;\n\ttouch [% bowtie_build.touch %] 2>[% bowtie_build.err %]"
  condition: once
  mem: 5000
  placeholders: 
    - bowtie_build
    - bowtie_build.touch
    - bowtie_build.err
bowtie_buildcast: 
  cmd: "cd [% bowtie_buildcast %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;trap SomeErrorHandler ERR; gunzip -f /lustre/scratch109/sanger/rg12/genome/CASTEiJ/mm10_CAST.fa.gz;\tbowtie2-build -f /lustre/scratch109/sanger/rg12/genome/CASTEiJ/mm10_CAST.fa /lustre/scratch109/sanger/rg12/genome/CASTEiJ_indexed/CASTEiJ;\n\tgzip /lustre/scratch109/sanger/rg12/genome/CASTEiJ/mm10_CAST.fa;\n\ttouch [% bowtie_buildcast.touch %] 2>[% bowtie_buildcast.err %]"
  condition: once
  mem: 5000
  placeholders: 
    - bowtie_buildcast
    - bowtie_buildcast.touch
    - bowtie_buildcast.err
bowtieinp: 
  cmd: "cd [% bowtieinp %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tls [% bowtie_build.touch %] [% bowtie_buildcast.touch %];\n\tif [ [% datasource.SE_PE %] == \"PE\" ];\n\t\tthen [% software.bowtierun %] -p [% datasource.SE_PE %] -1 [% trimgaloreinp.output2 %] -2 [% trimgaloreinp.output4 %] -o [% bowtieinp.out.sam %] -s [% datasource.Strain %];\n\telse [% software.bowtierun %] -p [% datasource.SE_PE %] -1 [% trimgaloreinp.output2 %] -o [% bowtieinp.out.sam %] -s [% datasource.Strain %];\n\tfi 2>[% bowtieinp.err %]"
  condition: ~
  cores: 14
  mem: 7000
  placeholders: 
    - bowtieinp
    - bowtie_build.touch
    - bowtie_buildcast.touch
    - datasource.SE_PE
    - software.bowtierun
    - datasource.SE_PE
    - trimgaloreinp.output2
    - trimgaloreinp.output4
    - bowtieinp.out.sam
    - datasource.Strain
    - software.bowtierun
    - datasource.SE_PE
    - trimgaloreinp.output2
    - bowtieinp.out.sam
    - datasource.Strain
    - bowtieinp.err
createhub: 
  cmd: "cd [% createhub %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc; \ttrap SomeErrorHandler ERR;\n \ttest -e [% jobs.macsunmerged.output1 %];\n \tnames=\"[% jobs.datasource.Name %]\";\n \tnames1=$(echo $names | sed -r 's/([a-zA-Z0-9_]+)/&-narrowout/g');\n \tnames2=$(echo $names | sed -r 's/([a-zA-Z0-9_]+)/&-broadout/g');\n \tnames3=$(echo $names | sed -r 's/([a-zA-Z0-9_]+)/&-gappedout/g');\n \t#names=$(echo $names1 $names2 $names3);\n \tlength=($names1);\n \ti=${#length[@]};\n \tpeaks=$(perl -E \"print 'narrow ' x $i; print 'broad ' x $i; print 'gapped ' x $i\");\n \tnarrowpeaks=$(perl -E \"print 'narrow ' x $i;\");\n \tbroadpeaks=$(perl -E \"print 'broad ' x $i;\");\n \tgappedpeaks=$(perl -E \"print 'gapped ' x $i\");\n \tbedfilestreat=$(echo $names | sed -r 's/([a-zA-Z0-9_]+)/&-ChIPseqout_treat_pileup.bdg/g');\n \tbedfilescontr=$(echo $names | sed -r 's/([a-zA-Z0-9_]+)/&-ChIPseqout_control_lambda.bdg/g');\n \tbwfiles=$(echo $names | sed -r 's/([a-zA-Z0-9_]+)/&-FoldE.bw/g');\n\n \trunnum=$(echo \"[% macsunmerged.output1 %]\" |sed -r 's/.*run([0-9]+).*/\\1/');\n \t###\n\teval echo \"createtrack.pl --vocab_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/bp-vocab-2910141000.json\\' --sexes \\'[% jobs.datasource.Sex_letter %]\\' --strain \\'[% jobs.datasource.Strain_short %]\\' --cell_types \\'[% jobs.datasource.Cell %]\\' --hmark \\'[% jobs.datasource.Mark %]\\' --replicate \\'[% jobs.datasource.repeat %]\\' --peak \\'$narrowpeaks\\' --url_names \\'$names1\\' --type \\'hammock\\' --base_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/ChIPseq/symlink/macsunmergednarrowpeak/$runnum\\' --url_suffix \\'.gz\\' \\> narrow.hub;\" > [% createhub.out %];\n\teval echo \"createtrack.pl --vocab_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/bp-vocab-2910141000.json\\' --sexes \\'[% jobs.datasource.Sex_letter %]\\' --strain \\'[% jobs.datasource.Strain_short %]\\' --cell_types \\'[% jobs.datasource.Cell %]\\' --hmark \\'[% jobs.datasource.Mark %]\\' --replicate \\'[% jobs.datasource.repeat %]\\' --peak \\'$broadpeaks\\' --url_names \\'$names2\\' --type \\'hammock\\' --base_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/ChIPseq/symlink/macsunmergedbroadpeak/$runnum\\' --url_suffix \\'.gz\\' \\> broad.hub;\" >> [% createhub.out %];\n\teval echo \"createtrack.pl --vocab_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/bp-vocab-2910141000.json\\' --sexes \\'[% jobs.datasource.Sex_letter %]\\' --strain \\'[% jobs.datasource.Strain_short %]\\' --cell_types \\'[% jobs.datasource.Cell %]\\' --hmark \\'[% jobs.datasource.Mark %]\\' --replicate \\'[% jobs.datasource.repeat %]\\' --peak \\'$gappedpeaks\\' --url_names \\'$names3\\' --type \\'hammock\\' --base_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/ChIPseq/symlink/macsunmergedbroadpeak/$runnum\\' --url_suffix \\'.gz\\' \\> gapped.hub;\">> [% createhub.out %];\n \t###\n \t#Alignment\n \teval echo \"createtrack.pl --vocab_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/bp-vocab-2910141000.json\\' --sexes \\'[% jobs.datasource.Sex_letter %]\\' --strain \\'[% jobs.datasource.Strain_short %]\\' --cell_types \\'[% jobs.datasource.Cell %]\\' --hmark \\'[% jobs.datasource.Mark %]\\' --replicate \\'[% jobs.datasource.repeat %]\\'  --url_names \\'$bedfilestreat\\' --type \\'bedgraph\\' --base_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/ChIPseq/symlink/macsunmergednarrowpeak/$runnum\\' --url_suffix \\'.gz\\'\\> treatout.hub; \" >>[% createhub.out %];\n \teval echo \"createtrack.pl --vocab_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/bp-vocab-2910141000.json\\' --sexes \\'[% jobs.datasource.Sex_letter %]\\' --strain \\'[% jobs.datasource.Strain_short %]\\' --cell_types \\'[% jobs.datasource.Cell %]\\' --hmark \\'[% jobs.datasource.Mark %]\\' --replicate \\'[% jobs.datasource.repeat %]\\'  --url_names \\'$bedfilescontr\\' --type \\'bedgraph\\' --base_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/ChIPseq/symlink/macsunmergednarrowpeak/$runnum\\' --url_suffix \\'.gz\\' \\> controlout.hub;\" >> [% createhub.out %];\n \teval echo \"createtrack.pl --vocab_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/bp-vocab-2910141000.json\\' --sexes \\'[% jobs.datasource.Sex_letter %]\\' --strain \\'[% jobs.datasource.Strain_short %]\\' --cell_types \\'[% jobs.datasource.Cell %]\\' --hmark \\'[% jobs.datasource.Mark %]\\' --replicate \\'[% jobs.datasource.repeat %]\\'  --url_names \\'$bwfiles\\' --type \\'bigwig\\' --base_url \\'ftp://ngs.sanger.ac.uk/scratch/project/rg12/ChIPseq/symlink/macsunmergednarrowpeak/$runnum\\' \\> folde.hub;\" >> [% createhub.out %]; 2>[% createhub.err %]"
  condition: once
  mem: 5000
  placeholders: 
    - createhub
    - jobs.macsunmerged.output1
    - jobs.datasource.Name
    - macsunmerged.output1
    - jobs.datasource.Sex_letter
    - jobs.datasource.Strain_short
    - jobs.datasource.Cell
    - jobs.datasource.Mark
    - jobs.datasource.repeat
    - createhub.out
    - jobs.datasource.Sex_letter
    - jobs.datasource.Strain_short
    - jobs.datasource.Cell
    - jobs.datasource.Mark
    - jobs.datasource.repeat
    - createhub.out
    - jobs.datasource.Sex_letter
    - jobs.datasource.Strain_short
    - jobs.datasource.Cell
    - jobs.datasource.Mark
    - jobs.datasource.repeat
    - createhub.out
    - jobs.datasource.Sex_letter
    - jobs.datasource.Strain_short
    - jobs.datasource.Cell
    - jobs.datasource.Mark
    - jobs.datasource.repeat
    - createhub.out
    - jobs.datasource.Sex_letter
    - jobs.datasource.Strain_short
    - jobs.datasource.Cell
    - jobs.datasource.Mark
    - jobs.datasource.repeat
    - createhub.out
    - jobs.datasource.Sex_letter
    - jobs.datasource.Strain_short
    - jobs.datasource.Cell
    - jobs.datasource.Mark
    - jobs.datasource.repeat
    - createhub.out
    - createhub.err
createhubgroup: 
  cmd: cd [% createhubgroup %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc; 	#ls * | grep -v err | xargs rm -rf; 2>[% createhubgroup.err %]
  condition: groupby
  condition_params: 
    - Mark
  mem: 5000
  placeholders: 
    - createhubgroup
    - createhubgroup.err
fastquality: 
  cmd: "cd [% fastquality %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tgunzip -c [% trimgalore.output2 %] | fastx_quality_stats -o [% fastquality.out1 %];\n\tfastq_quality_boxplot_graph.sh -i [% fastquality.out1 %] -o [% fastquality.out1.png %] -t [% datasource.Name %]_read1;\n\tgunzip -c [% trimgaloreinp.output2 %] | fastx_quality_stats -o [% fastquality.Inpout1 %];\n\tfastq_quality_boxplot_graph.sh -i [% fastquality.Inpout1 %] -o [% fastquality.Inpout1.png %] -t [% datasource.Name %]_input_read1;\n\tif [ [% datasource.SE_PE %] == \"PE\" ];\n\tthen gunzip -c [% trimgalore.output4 %] | fastx_quality_stats -o [% fastquality.out2 %];\n\t\tfastq_quality_boxplot_graph.sh -i [% fastquality.out2 %] -o [% fastquality.out2.png %] -t [% datasource.Name %]_read2;\n\t\tgunzip -c [% trimgaloreinp.output4 %] | fastx_quality_stats -o [% fastquality.Inpout2 %];\n\t\tfastq_quality_boxplot_graph.sh -i [% fastquality.Inpout2 %] -o [% fastquality.Inpout2.png %] -t [% datasource.Name %]_input_read2;\n\tfi 2>[% fastquality.err %]"
  condition: ~
  mem: 50
  placeholders: 
    - fastquality
    - trimgalore.output2
    - fastquality.out1
    - fastquality.out1
    - fastquality.out1.png
    - datasource.Name
    - trimgaloreinp.output2
    - fastquality.Inpout1
    - fastquality.Inpout1
    - fastquality.Inpout1.png
    - datasource.Name
    - datasource.SE_PE
    - trimgalore.output4
    - fastquality.out2
    - fastquality.out2
    - fastquality.out2.png
    - datasource.Name
    - trimgaloreinp.output4
    - fastquality.Inpout2
    - fastquality.Inpout2
    - fastquality.Inpout2.png
    - datasource.Name
    - fastquality.err
macsmergedbroad: 
  cmd: "cd [% macsmergedbroad %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tif [ [% datasource.SE_PE %] == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 [% bedcorrelate.broadintersect.txt %]);\n\tint=${last%.*};\n\tif [ $int -gt 75 ];\n\t\tthen macs2 callpeak -t [% groupby.replicate.samtoolsview.out.sorted.bam %] -c [% groupby.replicate.samtoolsviewInp.out.sorted.bam %] -f $paired -g mm -n ChIPseqout -B --SPMR -q 0.01 --broad --broad-cutoff 0.1 --fix-bimodal --extsize [% datasource.sonication %] --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t [% macsmergedbroad.output4 %] -c [% macsmergedbroad.output5 %] -o [% macsmergedbroad.FoldE.bdg %] -m FE\";\n\t\tmacs2 bdgcmp -t [% macsmergedbroad.output4 %] -c [% macsmergedbroad.output5 %] -o [% macsmergedbroad.FoldE.bdg %] -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t [% macsmergedbroad.output4 %] -c [% macsmergedbroad.output5 %] -o [% macsmergedbroad.logLR.bdg %] -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t [% macsmergedbroad.output4 %] -c [% macsmergedbroad.output5 %] -o [% macsmergedbroad.logLR.bdg %] -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw [% macsmergedbroad.FoldE.bdg %] [% input.mm10.len %]\";\n\t\tbdg2bw [% macsmergedbroad.FoldE.bdg %] [% input.mm10.len %];\n\t\t>&2 echo \"bdg2bw [% macsmergedbroad.logLR.bdg %] [% input.mm10.len %]\";\n\t\tbdg2bw [% macsmergedbroad.logLR.bdg %] [% input.mm10.len %];\n\t\t###\n\t\tRscript [% macsmergedbroad.output3 %];\n\t\tbroadpeak.py [% macsmergedbroad.output1 %] broadout;\n\t\tgappedpeak.py [% macsmergedbroad.output2 %] gappedout;\n\tfi 2>[% macsmergedbroad.err %]"
  condition: groupby
  condition_params: 
    - replicate
  cores: 5
  mem: 5000
  outputfiles: 
    - ChIPseqout_peaks.broadPeak
    - ChIPseqout_peaks.gappedPeak
    - ChIPseqout_model.r
    - ChIPseqout_treat_pileup.bdg
    - ChIPseqout_control_lambda.bdg
    - FoldE.bw
    - logLR.bw
  placeholders: 
    - macsmergedbroad
    - datasource.SE_PE
    - bedcorrelate.broadintersect.txt
    - groupby.replicate.samtoolsview.out.sorted.bam
    - groupby.replicate.samtoolsviewInp.out.sorted.bam
    - datasource.sonication
    - macsmergedbroad.output4
    - macsmergedbroad.output5
    - macsmergedbroad.FoldE.bdg
    - macsmergedbroad.output4
    - macsmergedbroad.output5
    - macsmergedbroad.FoldE.bdg
    - macsmergedbroad.output4
    - macsmergedbroad.output5
    - macsmergedbroad.logLR.bdg
    - macsmergedbroad.output4
    - macsmergedbroad.output5
    - macsmergedbroad.logLR.bdg
    - macsmergedbroad.FoldE.bdg
    - input.mm10.len
    - macsmergedbroad.FoldE.bdg
    - input.mm10.len
    - macsmergedbroad.logLR.bdg
    - input.mm10.len
    - macsmergedbroad.logLR.bdg
    - input.mm10.len
    - macsmergedbroad.output3
    - macsmergedbroad.output1
    - macsmergedbroad.output2
    - macsmergedbroad.err
macsmergednarrow: 
  cmd: "cd [% macsmergednarrow %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tif [ [% datasource.SE_PE %] == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tlast=$(tail -1 [% bedcorrelate.narrowintersect.txt %]);\n\tint=${last%.*};\n\tif [ $int -gt 75 ];\n\t\tthen macs2 callpeak -t [% groupby.replicate.samtoolsview.out.sorted.bam %] -c [% groupby.replicate.samtoolsviewInp.out.sorted.bam %] -f $paired -g mm -n ChIPseqout -B --SPMR -q 0.01 --fix-bimodal --extsize [% datasource.sonication %] --keep-dup auto;\n\t\t###\n\t\t>&2 echo \"macs2 bdgcmp -t [% macsmergednarrow.output4 %] -c [% macsmergednarrow.output5 %] -o [% macsmergednarrow.FoldE.bdg %] -m FE\";\n\t\tmacs2 bdgcmp -t [% macsmergednarrow.output4 %] -c [% macsmergednarrow.output5 %] -o [% macsmergednarrow.FoldE.bdg %] -m FE;\n\t\t>&2 echo \"macs2 bdgcmp -t [% macsmergednarrow.output4 %] -c [% macsmergednarrow.output5 %] -o [% macsmergednarrow.logLR.bdg %] -m logLR -p 0.00001\";\n\t\tmacs2 bdgcmp -t [% macsmergednarrow.output4 %] -c [% macsmergednarrow.output5 %] -o [% macsmergednarrow.logLR.bdg %] -m logLR -p 0.00001;\n\t\t###\n\t\t>&2 echo \"bdg2bw [% macsmergednarrow.FoldE.bdg %] [% input.mm10.len %]\";\n\t\tbdg2bw [% macsmergednarrow.FoldE.bdg %] [% input.mm10.len %];\n\t\t>&2 echo \"bdg2bw [% macsmergednarrow.logLR.bdg %] [% input.mm10.len %]\";\n\t\tbdg2bw [% macsmergednarrow.logLR.bdg %] [% input.mm10.len %];\n\t\t###\n\t\tRscript [% macsmergednarrow.output2 %];\n\t\tnarrowpeak.py [% macsmergednarrow.output1 %] narrowout;\n\tfi 2>[% macsmergednarrow.err %]"
  condition: groupby
  condition_params: 
    - replicate
  cores: 5
  mem: 5000
  outputfiles: 
    - ChIPseqout_peaks.narrowPeak
    - ChIPseqout_model.r
    - ChIPseqout_treat_pileup.bdg
    - ChIPseqout_control_lambda.bdg
    - FoldE.bw
    - logLR.bw
  placeholders: 
    - macsmergednarrow
    - datasource.SE_PE
    - bedcorrelate.narrowintersect.txt
    - groupby.replicate.samtoolsview.out.sorted.bam
    - groupby.replicate.samtoolsviewInp.out.sorted.bam
    - datasource.sonication
    - macsmergednarrow.output4
    - macsmergednarrow.output5
    - macsmergednarrow.FoldE.bdg
    - macsmergednarrow.output4
    - macsmergednarrow.output5
    - macsmergednarrow.FoldE.bdg
    - macsmergednarrow.output4
    - macsmergednarrow.output5
    - macsmergednarrow.logLR.bdg
    - macsmergednarrow.output4
    - macsmergednarrow.output5
    - macsmergednarrow.logLR.bdg
    - macsmergednarrow.FoldE.bdg
    - input.mm10.len
    - macsmergednarrow.FoldE.bdg
    - input.mm10.len
    - macsmergednarrow.logLR.bdg
    - input.mm10.len
    - macsmergednarrow.logLR.bdg
    - input.mm10.len
    - macsmergednarrow.output2
    - macsmergednarrow.output1
    - macsmergednarrow.err
macsunmerged: 
  cmd: "cd [% macsunmerged %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; \tif [ [% datasource.SE_PE %] == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t [% samtoolsview.output1 %] -c [% samtoolsviewInp.output1 %] -f $paired -g mm -n ChIPseqout -B --SPMR -p 1 --fix-bimodal --extsize [% datasource.sonication %] --keep-dup auto; 2>[% macsunmerged.err %]"
  condition: ~
  cores: 5
  mem: 5000
  outputfiles: 
    - ChIPseqout_peaks.narrowPeak
    - ChIPseqout_model.r
    - ChIPseqout_treat_pileup.bdg
    - ChIPseqout_control_lambda.bdg
    - FoldE.bw
    - logLR.bw
  placeholders: 
    - macsunmerged
    - datasource.SE_PE
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - datasource.sonication
    - macsunmerged.err
macsunmergedbroadpeak: 
  cmd: "cd [% macsunmergedbroadpeak %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; ls * | grep -v err | xargs rm -rf;\t. /nfs/users/nfs_r/rg12/.bashrc;\n\ttrap SomeErrorHandler ERR;\n\tif [ [% datasource.SE_PE %] == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t [% samtoolsview.output1 %] -c [% samtoolsviewInp.output1 %] -f $paired -g mm -n ChIPseqout -B --SPMR -q 0.05 --broad --broad-cutoff 0.1 --fix-bimodal --extsize [% datasource.sonication %] --keep-dup auto;\n\t>&2 echo \"macs2 bdgcmp -t [% macsunmergedbroadpeak.output4 %] -c [% macsunmergedbroadpeak.output5 %] -o [% macsunmergedbroadpeak.FoldE.bdg %] -m FE\";\n\tmacs2 bdgcmp -t [% macsunmergedbroadpeak.output4 %] -c [% macsunmergedbroadpeak.output5 %] -o [% macsunmergedbroadpeak.FoldE.bdg %] -m FE;\n\t>&2 echo \"macs2 bdgcmp -t [% macsunmergedbroadpeak.output4 %] -c [% macsunmergedbroadpeak.output5 %] -o [% macsunmergedbroadpeak.logLR.bdg %] -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t [% macsunmergedbroadpeak.output4 %] -c [% macsunmergedbroadpeak.output5 %] -o [% macsunmergedbroadpeak.logLR.bdg %] -m logLR -p 0.00001;\n\t>&2 echo \"bdg2bw [% macsunmergedbroadpeak.FoldE.bdg %] [% input.mm10.len %]\";\n\tbdg2bw [% macsunmergedbroadpeak.FoldE.bdg %] [% input.mm10.len %];\n\t>&2 echo \"bdg2bw [% macsunmergedbroadpeak.logLR.bdg %] [% input.mm10.len %]\";\n\tbdg2bw [% macsunmergedbroadpeak.logLR.bdg %] [% input.mm10.len %];\n\t>&2 echo \"Rscript\";\n\tRscript [% macsunmergedbroadpeak.output3 %];\n\tbroadpeak.py [% macsunmergedbroadpeak.output1 %] broadout;\n\tgappedpeak.py [% macsunmergedbroadpeak.output2 %] gappedout;\n\tbedtools genomecov -i [% macsunmergedbroadpeak.output1 %] -g [% input.mm10.len %] -bg > [% macsunmergedbroadpeak.broad.bdg %];\n\tbedtools genomecov -i [% macsunmergedbroadpeak.output2 %] -g [% input.mm10.len %] -bg > [% macsunmergedbroadpeak.gapped.bdg %]; 2>[% macsunmergedbroadpeak.err %]"
  condition: ~
  cores: 5
  mem: 5000
  outputfiles: 
    - ChIPseqout_peaks.broadPeak
    - ChIPseqout_peaks.gappedPeak
    - ChIPseqout_model.r
    - ChIPseqout_treat_pileup.bdg
    - ChIPseqout_control_lambda.bdg
    - FoldE.bw
    - logLR.bw
  placeholders: 
    - macsunmergedbroadpeak
    - datasource.SE_PE
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - datasource.sonication
    - macsunmergedbroadpeak.output4
    - macsunmergedbroadpeak.output5
    - macsunmergedbroadpeak.FoldE.bdg
    - macsunmergedbroadpeak.output4
    - macsunmergedbroadpeak.output5
    - macsunmergedbroadpeak.FoldE.bdg
    - macsunmergedbroadpeak.output4
    - macsunmergedbroadpeak.output5
    - macsunmergedbroadpeak.logLR.bdg
    - macsunmergedbroadpeak.output4
    - macsunmergedbroadpeak.output5
    - macsunmergedbroadpeak.logLR.bdg
    - macsunmergedbroadpeak.FoldE.bdg
    - input.mm10.len
    - macsunmergedbroadpeak.FoldE.bdg
    - input.mm10.len
    - macsunmergedbroadpeak.logLR.bdg
    - input.mm10.len
    - macsunmergedbroadpeak.logLR.bdg
    - input.mm10.len
    - macsunmergedbroadpeak.output3
    - macsunmergedbroadpeak.output1
    - macsunmergedbroadpeak.output2
    - macsunmergedbroadpeak.output1
    - input.mm10.len
    - macsunmergedbroadpeak.broad.bdg
    - macsunmergedbroadpeak.output2
    - input.mm10.len
    - macsunmergedbroadpeak.gapped.bdg
    - macsunmergedbroadpeak.err
macsunmergednarrowpeak: 
  cmd: "cd [% macsunmergednarrowpeak %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; ls * | grep -v err | xargs rm -rf;\t. /nfs/users/nfs_r/rg12/.bashrc;\n\ttrap SomeErrorHandler ERR;\n\tif [ [% datasource.SE_PE %] == \"PE\" ]; then paired=\"BAMPE\";else paired=\"BAM\";fi;\n\tmacs2 callpeak -t [% samtoolsview.output1 %] -c [% samtoolsviewInp.output1 %] -f $paired -g mm -n ChIPseqout -B --SPMR -q 0.01 --fix-bimodal --extsize [% datasource.sonication %] --keep-dup auto;\n\t###\n\t>&2 echo \"macs2 bdgcmp -t [% macsunmergednarrowpeak.output3 %] -c [% macsunmergednarrowpeak.output4 %] -o [% macsunmergednarrowpeak.FoldE.bdg %] -m FE\";\n\tmacs2 bdgcmp -t [% macsunmergednarrowpeak.output3 %] -c [% macsunmergednarrowpeak.output4 %] -o [% macsunmergednarrowpeak.FoldE.bdg %] -m FE;\n\t>&2 echo \"macs2 bdgcmp -t [% macsunmergednarrowpeak.output3 %] -c [% macsunmergednarrowpeak.output4 %] -o [% macsunmergednarrowpeak.logLR.bdg %] -m logLR -p 0.00001\";\n\tmacs2 bdgcmp -t [% macsunmergednarrowpeak.output3 %] -c [% macsunmergednarrowpeak.output4 %] -o [% macsunmergednarrowpeak.logLR.bdg %] -m logLR -p 0.00001;\n\t###\n\t>&2 echo \"bdg2bw [% macsunmergednarrowpeak.FoldE.bdg %] [% input.mm10.len %]\";\n\tbdg2bw [% macsunmergednarrowpeak.FoldE.bdg %] [% input.mm10.len %];\n\t>&2 echo \"bdg2bw [% macsunmergednarrowpeak.logLR.bdg %] [% input.mm10.len %]\";\n\tbdg2bw [% macsunmergednarrowpeak.logLR.bdg %] [% input.mm10.len %];\n\t###\n\t>&2 echo \"Rscript\";\n\tRscript [% macsunmergednarrowpeak.output2 %];\n\tnarrowpeak.py [% macsunmergednarrowpeak.output1 %] narrowout;\n\t###\n\tbgzip [% macsunmergednarrowpeak.output3 %];\n\tbgzip [% macsunmergednarrowpeak.output4 %];\n\ttabix -p bed [% macsunmergednarrowpeak.output7 %];\n\ttabix -p bed [% macsunmergednarrowpeak.output8 %];\n\tbedtools genomecov -i [% macsunmergednarrowpeak.output1 %] -g [% input.mm10.len %] -bg > [% macsunmergednarrowpeak.narrow.bdg %]; 2>[% macsunmergednarrowpeak.err %]"
  condition: ~
  cores: 5
  mem: 5000
  outputfiles: 
    - ChIPseqout_peaks.narrowPeak
    - ChIPseqout_model.r
    - ChIPseqout_treat_pileup.bdg
    - ChIPseqout_control_lambda.bdg
    - FoldE.bw
    - logLR.bw
    - ChIPseqout_treat_pileup.bdg.gz
    - ChIPseqout_control_lambda.bdg.gz
    - ChIPseqout_treat_pileup.bdg.gz.tbi
    - ChIPseqout_control_lambda.bdg.gz.tbi
  placeholders: 
    - macsunmergednarrowpeak
    - datasource.SE_PE
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - datasource.sonication
    - macsunmergednarrowpeak.output3
    - macsunmergednarrowpeak.output4
    - macsunmergednarrowpeak.FoldE.bdg
    - macsunmergednarrowpeak.output3
    - macsunmergednarrowpeak.output4
    - macsunmergednarrowpeak.FoldE.bdg
    - macsunmergednarrowpeak.output3
    - macsunmergednarrowpeak.output4
    - macsunmergednarrowpeak.logLR.bdg
    - macsunmergednarrowpeak.output3
    - macsunmergednarrowpeak.output4
    - macsunmergednarrowpeak.logLR.bdg
    - macsunmergednarrowpeak.FoldE.bdg
    - input.mm10.len
    - macsunmergednarrowpeak.FoldE.bdg
    - input.mm10.len
    - macsunmergednarrowpeak.logLR.bdg
    - input.mm10.len
    - macsunmergednarrowpeak.logLR.bdg
    - input.mm10.len
    - macsunmergednarrowpeak.output2
    - macsunmergednarrowpeak.output1
    - macsunmergednarrowpeak.output3
    - macsunmergednarrowpeak.output4
    - macsunmergednarrowpeak.output7
    - macsunmergednarrowpeak.output8
    - macsunmergednarrowpeak.output1
    - input.mm10.len
    - macsunmergednarrowpeak.narrow.bdg
    - macsunmergednarrowpeak.err
pdfmerge: 
  cmd: "cd [% pdfmerge %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\tls * | grep -v err | xargs rm -rf;\n\ttrap SomeErrorHandler ERR;\n\tpdfunite [% groupby.Mark.annotatepeaksgroup.cluster.4.pdf %] Cluster4.pdf;\n\tpdfunite [% groupby.Mark.annotatepeaksgroup.cluster.5.pdf %] Cluster5.pdf;\n\tpdfunite [% groupby.Mark.annotatepeaksgroup.cluster.6.pdf %] Cluster6.pdf;\n\tpdfunite [% groupby.Mark.annotatepeaksgroup.cluster.7.pdf %] Cluster7.pdf;\n\tpdfunite [% groupby.Mark.annotatepeaksgroup.cluster.8.pdf %] Cluster8.pdf;\n\tpdfunite [% groupby.Mark.annotatepeaksgroup.cluster.9.pdf %] Cluster9.pdf;\n\tpdfunite [% groupby.Mark.annotatepeaksgroup.cluster.10.pdf %] Cluster10.pdf; 2>[% pdfmerge.err %]"
  condition: groupby
  condition_params: 
    - Mark
  cores: 5
  mem: 5000
  placeholders: 
    - pdfmerge
    - groupby.Mark.annotatepeaksgroup.cluster.4.pdf
    - groupby.Mark.annotatepeaksgroup.cluster.5.pdf
    - groupby.Mark.annotatepeaksgroup.cluster.6.pdf
    - groupby.Mark.annotatepeaksgroup.cluster.7.pdf
    - groupby.Mark.annotatepeaksgroup.cluster.8.pdf
    - groupby.Mark.annotatepeaksgroup.cluster.9.pdf
    - groupby.Mark.annotatepeaksgroup.cluster.10.pdf
    - pdfmerge.err
pie: 
  cmd: "cd [% pie %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; ls * | grep -v err | xargs rm -rf;\t. /nfs/users/nfs_r/rg12/.bashrc;\n\ttrap SomeErrorHandler ERR;\n\t#gapped broad output\n\tbedtools intersect -loj -a [% macsunmergedbroadpeak.output2 %] -b [% input.ens_genes_and_promoter_distal.bed %] > [% pie.out %];\n\tbedtools intersect -loj -a [% macsunmergednarrowpeak.output1 %] -b [% input.ens_genes_and_promoter_distal.bed %] > [% pie.out2 %];\n\tbedtools intersect -wa -b [% macsunmergedbroadpeak.output2 %] -a [% input.ens_genes_and_promoter_distal.bed %] > [% pie.out3 %];\n\tbedtools intersect -wa -b [% macsunmergednarrowpeak.output1 %] -a [% input.ens_genes_and_promoter_distal.bed %] > [% pie.out4 %];\n\tRscript [% software.pie.R %] $(grep -c Gene [% pie.out %]) $(grep -c Distal [% pie.out %]) $(grep -c Promoter [% pie.out %]) $(cat [% pie.out %] |wc -l) rplot_broad.pdf > [% pie.broad %]\n\tRscript [% software.pie.R %] $(grep -c Gene [% pie.out2 %]) $(grep -c Distal [% pie.out2 %]) $(grep -c Promoter [% pie.out2 %]) $(cat [% pie.out2 %] |wc -l) rplot_narrow.pdf > [% pie.narrow %]\n\tRscript [% software.pie.R %] $(grep -c Gene [% pie.out3 %]) $(grep -c Distal [% pie.out3 %]) $(grep -c Promoter [% pie.out3 %]) $(cat [% pie.out3 %] |wc -l) rplot_gene_broad.pdf > [% pie.gene_broad %]\n\tRscript [% software.pie.R %] $(grep -c Gene [% pie.out4 %]) $(grep -c Distal [% pie.out4 %]) $(grep -c Promoter [% pie.out4 %]) $(cat [% pie.out4 %] |wc -l) rplot_gene_narrow.pdf > [% pie.gene_narrow %] 2>[% pie.err %]"
  condition: ~
  mem: 5000
  placeholders: 
    - pie
    - macsunmergedbroadpeak.output2
    - input.ens_genes_and_promoter_distal.bed
    - pie.out
    - macsunmergednarrowpeak.output1
    - input.ens_genes_and_promoter_distal.bed
    - pie.out2
    - macsunmergedbroadpeak.output2
    - input.ens_genes_and_promoter_distal.bed
    - pie.out3
    - macsunmergednarrowpeak.output1
    - input.ens_genes_and_promoter_distal.bed
    - pie.out4
    - software.pie.R
    - pie.out
    - pie.out
    - pie.out
    - pie.out
    - pie.broad
    - software.pie.R
    - pie.out2
    - pie.out2
    - pie.out2
    - pie.out2
    - pie.narrow
    - software.pie.R
    - pie.out3
    - pie.out3
    - pie.out3
    - pie.out3
    - pie.gene_broad
    - software.pie.R
    - pie.out4
    - pie.out4
    - pie.out4
    - pie.out4
    - pie.gene_narrow
    - pie.err
samtoolsview: 
  cmd: "cd [% samtoolsview %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\ttest -e [% bowtie.out.sam %];\n\tsamtools view -hSb [% bowtie.out.sam %]> [% samtoolsview.out.bam %];\n\tsamtools sort [% samtoolsview.out.bam %] out.sorted;\n\tsamtools index [% samtoolsview.output1 %];\n\trm [% bowtie.out.sam %]; 2>[% samtoolsview.err %]"
  condition: ~
  mem: 2000
  outputfiles: 
    - out.sorted.bam
    - out.sorted.bam.bai
  placeholders: 
    - samtoolsview
    - bowtie.out.sam
    - bowtie.out.sam
    - samtoolsview.out.bam
    - samtoolsview.out.bam
    - samtoolsview.output1
    - bowtie.out.sam
    - samtoolsview.err
samtoolsviewInp: 
  cmd: "cd [% samtoolsviewInp %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\ttest -e [% bowtieinp.out.sam %];\n\tsamtools view -hSb [% bowtieinp.out.sam %] > [% samtoolsviewInp.out.bam %];\n\tsamtools sort [% samtoolsviewInp.out.bam %] out.sorted;\n\tsamtools index [% samtoolsviewInp.output1 %];\n\trm [% bowtieinp.out.sam %]; 2>[% samtoolsviewInp.err %]"
  condition: ~
  mem: 2000
  outputfiles: 
    - out.sorted.bam
    - out.sorted.bam.bai
  placeholders: 
    - samtoolsviewInp
    - bowtieinp.out.sam
    - bowtieinp.out.sam
    - samtoolsviewInp.out.bam
    - samtoolsviewInp.out.bam
    - samtoolsviewInp.output1
    - bowtieinp.out.sam
    - samtoolsviewInp.err
seperateclusters: 
  cmd: "cd [% seperateclusters %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\tls * | grep -v err | xargs rm -rf;\n\ttrap SomeErrorHandler ERR;\n\tclusters=4;\n\tcp [% annotatepeaksgroup.output1 %] [% seperateclusters.clusters.RData %];\n\tExtractGName.R [% seperateclusters.clusters.RData %];\n\t>&2 echo \"cluster1-4\";\n\tfor i in {1..4}\n\tdo\n\t\t>&2 echo \"cluster\" ${i};\n\t\techo -e \"[% samtoolsview.output1 %]:[% samtoolsviewInp.output1 %]\tclusters.1.cluster${i}.txt\t\\\"[% datasource.mark_full %] [% datasource.Cell %] Cell\\\"\" > [% seperateclusters.config.txt %];\n\t\t>&2 echo \"ngs.plot.r -G mm10 -R genebody -C [% seperateclusters.config.txt %] -O heatmapclusters.${i} -L 5000 -GO total -CO blue:white:red -P 5\";\n\t\tngs.plot.r -G mm10 -R genebody -C [% seperateclusters.config.txt %] -O heatmapclusters.${i} -L 3000 -GO total -CO blue:white:red -P 5;\n\t\tconvert -density 150 heatmapclusters.${i}.heatmap.pdf -quality 90 heatmapclusters.${i}.heatmap.png;\n\tdone 2>[% seperateclusters.err %]"
  condition: ~
  cores: 5
  mem: 5000
  placeholders: 
    - seperateclusters
    - annotatepeaksgroup.output1
    - seperateclusters.clusters.RData
    - seperateclusters.clusters.RData
    - samtoolsview.output1
    - samtoolsviewInp.output1
    - datasource.mark_full
    - datasource.Cell
    - seperateclusters.config.txt
    - seperateclusters.config.txt
    - seperateclusters.config.txt
    - seperateclusters.err
summarystats: 
  cmd: "cd [% summarystats %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;trap SomeErrorHandler ERR;\tif [ [% datasource.SE_PE %] == \"PE\" ];\n\t\tthen if [ [% datasource.bam %] == \"TRUE\" ];\n\t\t\tthen echo \"[% datasource.Name %]_lane1\" > [% summarystats.out.flagstat %];\n\t\t\tsamtools flagstat [% datasource.location %]_1.bam >>[% summarystats.out.flagstat %];\n\t\t\techo \"[% datasource.Name %]_lane2\" >> [% summarystats.out.flagstat %];\n\t\t\tsamtools flagstat [% datasource.location %]_2.bam >> [% summarystats.out.flagstat %];\n\t\telse echo \"[% datasource.Name %]\" > [% summarystats.out.flagstat %];\n\t\t\techo \"FastQ\" > [% summarystats.out.flagstat %];\n\t\tfi;\n\t\tif [ [% datasource.Inp_bam %] == \"TRUE\" ];\n\t\t\tthen echo \"Inp_[% datasource.Name %]_lane1\" >> [% summarystats.out.flagstat %];\n\t\t\tsamtools flagstat [% datasource.Inp_location %]_1.bam >>[% summarystats.out.flagstat %];\n\t\t\techo \"Inp_[% datasource.Name %]_lane2\" >> [% summarystats.out.flagstat %];\n\t\t\tsamtools flagstat [% datasource.Inp_location %]_2.bam >> [% summarystats.out.flagstat %];\n\t\telse echo \"Inp_[% datasource.Name %]\" > [% summarystats.out.flagstat %];\n\t\t\techo \"FastQ\" > [% summarystats.out.flagstat %];\n\t\tfi;\n\telse if [ [% datasource.bam %] == \"TRUE\" ]; ### CHECK THIS!! SHOULD be INP_1 and INP_2\n\t\tthen echo \"[% datasource.Name %]_lane1\" > [% summarystats.out.flagstat %];\n\t\t\tsamtools flagstat [% datasource.location %]_1.bam >>[% summarystats.out.flagstat %];\n\t\t\techo \"[% datasource.Name %]_lane2\" >> [% summarystats.out.flagstat %];\n\t\t\tsamtools flagstat [% datasource.location %]_2.bam >> [% summarystats.out.flagstat %];\n\t\telse echo \"[% datasource.Name %]\" > [% summarystats.out.flagstat %];\n\t\t\techo \"FastQ\" > [% summarystats.out.flagstat %];\n\t\tfi;\n\t\tif [ [% datasource.Inp_bam %] == \"TRUE\" ];\n\t\t\tthen echo \"Inp_[% datasource.Name %]_lane1\" >> [% summarystats.out.flagstat %];\n\t\t\tsamtools flagstat [% datasource.Inp_location %]_1.bam >>[% summarystats.out.flagstat %];\n\t\t\techo \"Inp_[% datasource.Name %]_lane2\" >> [% summarystats.out.flagstat %];\n\t\t\tsamtools flagstat [% datasource.Inp_location %]_2.bam >> [% summarystats.out.flagstat %];\n\t\telse echo \"Inp_[% datasource.Name %]\" > [% summarystats.out.flagstat %];\n\t\t\techo \"FastQ\" > [% summarystats.out.flagstat %];\n\t\tfi;\n\tfi 2>[% summarystats.err %]"
  condition: ~
  mem: 1000
  placeholders: 
    - summarystats
    - datasource.SE_PE
    - datasource.bam
    - datasource.Name
    - summarystats.out.flagstat
    - datasource.location
    - summarystats.out.flagstat
    - datasource.Name
    - summarystats.out.flagstat
    - datasource.location
    - summarystats.out.flagstat
    - datasource.Name
    - summarystats.out.flagstat
    - summarystats.out.flagstat
    - datasource.Inp_bam
    - datasource.Name
    - summarystats.out.flagstat
    - datasource.Inp_location
    - summarystats.out.flagstat
    - datasource.Name
    - summarystats.out.flagstat
    - datasource.Inp_location
    - summarystats.out.flagstat
    - datasource.Name
    - summarystats.out.flagstat
    - summarystats.out.flagstat
    - datasource.bam
    - datasource.Name
    - summarystats.out.flagstat
    - datasource.location
    - summarystats.out.flagstat
    - datasource.Name
    - summarystats.out.flagstat
    - datasource.location
    - summarystats.out.flagstat
    - datasource.Name
    - summarystats.out.flagstat
    - summarystats.out.flagstat
    - datasource.Inp_bam
    - datasource.Name
    - summarystats.out.flagstat
    - datasource.Inp_location
    - summarystats.out.flagstat
    - datasource.Name
    - summarystats.out.flagstat
    - datasource.Inp_location
    - summarystats.out.flagstat
    - datasource.Name
    - summarystats.out.flagstat
    - summarystats.out.flagstat
    - summarystats.err
symlink: 
  cmd: "cd [% symlink %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc; \ttrap SomeErrorHandler ERR;\n \tls [% jobs.macsunmerged.output1 %];\n \trunnum=$(echo \"[% macsunmerged.output1 %]\" |sed -r 's/.*run([0-9]+).*/\\1/');\n \t>&2 echo $runnum;\n \tplite symlink -f Name -r $runnum -s summarystats#out.flagstat /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s trimgalore#out_1.fq.gz_trimming_report.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s trimgalore#out_2.fq.gz_trimming_report.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s trimgaloreinp#out_1.fq.gz_trimming_report.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s trimgaloreinp#out_2.fq.gz_trimming_report.txt /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s bowtie#err /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s bowtieinp#err /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s samtoolsview#out.sorted.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s samtoolsviewInp#out.sorted.bam /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s samtoolsview#out.sorted.bam.bai /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s samtoolsviewInp#out.sorted.bam.bai /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s fastquality#out1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s fastquality#out1.png /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s fastquality#out2 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s fastquality#out2.png /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s fastquality#Inpout1 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s fastquality#Inpout1.png /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s fastquality#Inpout2 /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \tplite symlink -f Name -r $runnum -s fastquality#Inpout2.png /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n \t###\n \t###\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#FoldE.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#logLR.bw /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#ChIPseqout_treat_pileup.bdg.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#ChIPseqout_treat_pileup.bdg.gz.tbi /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#ChIPseqout_control_lambda.bdg.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#ChIPseqout_control_lambda.bdg.gz.tbi /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#narrowout.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#narrowout.gz.tbi /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergedbroadpeak#broadout.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergedbroadpeak#broadout.gz.tbi /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergedbroadpeak#gappedout.gz /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergedbroadpeak#gappedout.gz.tbi /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergedbroadpeak#broad.bdg.tbi /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergedbroadpeak#gapped.bdg.tbi /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#narrow.bdg /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergedbroadpeak#ChIPseqout_peaks.gappedPeak /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergednarrowpeak#ChIPseqout_peaks.xls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s macsunmergedbroadpeak#ChIPseqout_peaks.xls /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\t#plite symlink -f Mark -r $runnum -s createhubgroup#out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Mark -r $runnum -s createhub#out /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s annotatepeaks#out.heatmap.pdf /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s annotatepeaks#out.avgprof.pdf /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s annotatepeaks#clusters.heatmap.pdf /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s annotatepeaks#clusters.avgprof.pdf /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s annotatepeaks#TPMorderedT.heatmap.pdf /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/;\n\tplite symlink -f Name -r $runnum -s annotatepeaks#TPMorderedB.heatmap.pdf  /lustre/scratch110/sanger/rg12/Pipeline/ChIPseq/; 2>[% symlink.err %]"
  condition: once
  mem: 5000
  placeholders: 
    - symlink
    - jobs.macsunmerged.output1
    - macsunmerged.output1
    - symlink.err
trimgalore: 
  cmd: "cd [% trimgalore %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tlength=$(gunzip -c [% bamtofq.out_1.fq.gz %] | head -2| tail -1 | wc -c);\n\tlength=$[length-11];\n\tif [ [% datasource.SE_PE %] == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a [% datasource.Tag %] --stringency 4 --trim1 [% bamtofq.out_1.fq.gz %] [% bamtofq.out_2.fq.gz %];\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a [% datasource.Tag %] --stringency 4 [% bamtofq.out_1.fq.gz %];\n\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz;\n\tfi 2>[% trimgalore.err %]"
  condition: ~
  cores: 3
  mem: 2000
  outputfiles: 
    - out_1.fq.gz_trimming_report.txt
    - out_1_val_1.fq.gz
    - out_2.fq.gz_trimming_report.txt
    - out_2_val_2.fq.gz
    - out_1_val_1.html
    - out_1_val_1.zip
    - out_2_val_2.html
    - out_2_val_2.zip
  placeholders: 
    - trimgalore
    - bamtofq.out_1.fq.gz
    - datasource.SE_PE
    - datasource.Tag
    - bamtofq.out_1.fq.gz
    - bamtofq.out_2.fq.gz
    - datasource.Tag
    - bamtofq.out_1.fq.gz
    - trimgalore.err
trimgaloreinp: 
  cmd: "cd [% trimgaloreinp %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tlength=$(gunzip -c [% bamtofqinp.out_1.fq.gz %] | head -2| tail -1 | wc -c);\n\tlength=$[length-11];\n\tif [ [% datasource.SE_PE %] == \"PE\" ];\n\tthen\n\t\ttrim_galore --fastqc --gzip --length $length --paired -a [% datasource.Inp_Tag %] --stringency 4 --trim1 [% bamtofqinp.out_1.fq.gz %] [% bamtofqinp.out_2.fq.gz %];\n\telse\n\t\ttrim_galore --fastqc --gzip --length $length -a [% datasource.Inp_Tag %] --stringency 4 [% bamtofqinp.out_1.fq.gz %];\n\t\tmv out_1_trimmed.fq.gz out_1_val_1.fq.gz; ### should FIX\n\tfi 2>[% trimgaloreinp.err %]"
  condition: ~
  cores: 3
  mem: 2000
  outputfiles: 
    - out_1.fq.gz_trimming_report.txt
    - out_1_val_1.fq.gz
    - out_2.fq.gz_trimming_report.txt
    - out_2_val_2.fq.gz
    - out_1_val_1.html
    - out_1_val_1.zip
    - out_2_val_2.html
    - out_2_val_2.zip
  placeholders: 
    - trimgaloreinp
    - bamtofqinp.out_1.fq.gz
    - datasource.SE_PE
    - datasource.Inp_Tag
    - bamtofqinp.out_1.fq.gz
    - bamtofqinp.out_2.fq.gz
    - datasource.Inp_Tag
    - bamtofqinp.out_1.fq.gz
    - trimgaloreinp.err
wigcorrelate: 
  cmd: "cd [% wigcorrelate %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\tls [% macsunmergedbroadpeak.output6 %];\n\tlength=([% groupby.replicate.macsunmergedbroadpeak.FoldE.bw %]);\n\t#Change FoldE.bw to output16\n\tif [ ${#length[@]} != 1 ];\n\t\tthen\n\t\twigCorrelate [% groupby.replicate.macsunmerged.FoldE.bw %] > [% wigcorrelate.out %];\n\tfi; 2>[% wigcorrelate.err %]"
  condition: groupby
  condition_params: 
    - replicate
  cores: 4
  mem: 5000
  placeholders: 
    - wigcorrelate
    - macsunmergedbroadpeak.output6
    - groupby.replicate.macsunmergedbroadpeak.FoldE.bw
    - groupby.replicate.macsunmerged.FoldE.bw
    - wigcorrelate.out
    - wigcorrelate.err
wigcorrelateall: 
  cmd: "cd [% wigcorrelateall %];  ls * | grep -v err | xargs rm -rf;. /nfs/users/nfs_r/rg12/.bashrc;>&2 date;trap SomeErrorHandler ERR; . /nfs/users/nfs_r/rg12/.bashrc;\ttrap SomeErrorHandler ERR;\n\t## ONLY SAYS HOW THE ALIGNMENT CORRELATES\n\t>&2 echo \"wigCorrelate macsunmergedbroadpeak FoldE\";\n\twigCorrelate [% jobs.macsunmergedbroadpeak.output6 %] > [% wigcorrelateall.macsunmergedbroadpeak_FoldE.txt %];\n\t>&2 echo \"wigCorrelate macsunmergedbroadpeak LogLR\";\n\twigCorrelate [% jobs.macsunmergedbroadpeak.output7 %] > [% wigcorrelateall.macsunmergedbroadpeak_logLR.txt %];\n\t>&2 echo \"wigCorrelate macsunmergednarrowpeak FoldE\";\n\twigCorrelate [% jobs.macsunmergednarrowpeak.output5 %] > [% wigcorrelateall.macsunmergednarrowpeak_FoldE.txt %];\n\t>&2 echo \"wigCorrelate macsunmergednarrowpeak LogLR\";\n\twigCorrelate [% jobs.macsunmergednarrowpeak.output6 %] > [% wigcorrelateall.macsunmergednarrowpeak_logLR.txt %]; 2>[% wigcorrelateall.err %]"
  condition: once
  cores: 4
  mem: 5000
  placeholders: 
    - wigcorrelateall
    - jobs.macsunmergedbroadpeak.output6
    - wigcorrelateall.macsunmergedbroadpeak_FoldE.txt
    - jobs.macsunmergedbroadpeak.output7
    - wigcorrelateall.macsunmergedbroadpeak_logLR.txt
    - jobs.macsunmergednarrowpeak.output5
    - wigcorrelateall.macsunmergednarrowpeak_FoldE.txt
    - jobs.macsunmergednarrowpeak.output6
    - wigcorrelateall.macsunmergednarrowpeak_logLR.txt
    - wigcorrelateall.err
